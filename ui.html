<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>lumitrans</title>

    <!-- Google Material Symbols Â≠ó‰ΩìÂºïÁî® -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <!-- Â§öËØ≠Ë®ÄÊï∞ÊçÆ -->
    <script>
        // ËØ≠Ë®ÄÊñá‰ª∂
        const i18nData = {
            'zh-CN': {
                // ‰∏ªÁïåÈù¢
                title: 'lumitransÁøªËØëÂä©Êâã',
                settings: 'ËÆæÁΩÆ',
                selectedText: '‰∏™ÊñáÊú¨ÂõæÂ±ÇÂ∑≤ÈÄâ‰∏≠',
                targetLanguage: 'ÁøªËØëÁõÆÊ†áËØ≠Ë®Ä',
                model: 'Ê®°Âûã',
                promptTemplate: 'ÊèêÁ§∫ËØçÊ®°Êùø',
                startTranslation: 'ÂºÄÂßãÁøªËØë',
                stopTranslation: 'ÂÅúÊ≠¢ÁøªËØë',

                // ËÆæÁΩÆÂØπËØùÊ°Ü
                apiUrl: 'APIÂú∞ÂùÄ',
                apiKey: 'APIÂØÜÈí•',
                prompt: 'ÊèêÁ§∫ËØç',
                save: '‰øùÂ≠ò',
                close: 'ÂÖ≥Èó≠',

                // ËØ≠Ë®ÄÈÄâÊã©
                language: 'ÁïåÈù¢ËØ≠Ë®Ä',

                // Âç†‰ΩçÁ¨¶ÊñáÊú¨
                placeholderApiUrl: 'https://api.openai.com/v1/chat/completions',
                placeholderApiKey: 'sk-...',
                placeholderModel: 'gpt-4.1-nano',
                placeholderPrompt: '‰Ω†ÊòØ‰∏Ä‰∏™‰∏ì‰∏öÁöÑÁøªËØëÂä©Êâã...',
                placeholderPromptName: '‰∏∫Ê≠§ÊèêÁ§∫ËØçÂëΩÂêç...',

                // Áä∂ÊÄÅÊ∂àÊÅØ
                statusConfigNeeded: 'ËØ∑ÂÖàÈÖçÁΩÆAPIËÆæÁΩÆ',
                statusConfigured: 'ÈÖçÁΩÆÂ∑≤ÂÆåÊàê',
                statusTranslating: 'ÁøªËØë‰∏≠...',
                statusCompleted: 'ÁøªËØëÂÆåÊàêÔºÅ',
                statusStopping: 'Ê≠£Âú®ÂÅúÊ≠¢ÁøªËØë...',
                statusError: 'ÁøªËØëÂá∫Èîô',

                // APIÁä∂ÊÄÅÁü≠ÊñáÊ°àÔºàÊñ∞Â¢ûÔºöÂ§öËØ≠Ë®ÄÁÆÄÁü≠ÊòæÁ§∫Ôºâ
                statusApiTestingShort: 'ÊµãËØï‰∏≠...',
                statusApiOkShort: 'Â∑≤ËøûÊé•',
                statusApiNotConfiguredShort: 'Êú™ÈÖçÁΩÆ',
                statusApiErrorShort: 'ËøûÊé•Â§±Ë¥•',

                // ËøõÂ∫¶Ê∂àÊÅØ
                progressProcessing: 'Ê≠£Âú®Â§ÑÁêÜ',
                progressTranslating: 'ÁøªËØëËøõÂ∫¶',

                // ÊèêÁ§∫ËØçÊ®°Êùø
                templateStandard: 'Ê†áÂáÜÁøªËØë',
                templateLocalization: 'Êú¨Âú∞Âåñ',
                templateUI: 'ÁïåÈù¢ÊñáÊ°à',
                templateTechnical: 'ÊäÄÊúØÊñáÊ°£',

                // ÊèêÁ§∫ËØçÊ®°ÊùøÂÜÖÂÆπ
                promptContentStandard: '‰Ω†ÊòØ‰∏Ä‰∏™‰∏ì‰∏öÁöÑÁøªËØëÂä©Êâã„ÄÇËØ∑Â∞ÜÁî®Êà∑Êèê‰æõÁöÑÊñáÊú¨ÁøªËØëÊàê{targetLanguage}„ÄÇÂè™ËøîÂõûÁøªËØëÁªìÊûúÔºå‰∏çË¶ÅÊ∑ªÂä†‰ªª‰ΩïËß£ÈáäÊàñÂÖ∂‰ªñÂÜÖÂÆπ„ÄÇ',
                promptContentLocalization: '‰Ω†ÊòØ‰∏Ä‰∏™‰∏ì‰∏öÁöÑÊú¨Âú∞Âåñ‰∏ìÂÆ∂„ÄÇËØ∑Â∞Ü‰ª•‰∏ãÊñáÊú¨ÁøªËØëÊàê{targetLanguage}Ôºå‰øùÊåÅÂéüÊñáÁöÑËØ≠Ê∞îÂíåÈ£éÊ†ºÔºå‰ΩøÂÖ∂Á¨¶ÂêàÁõÆÊ†áËØ≠Ë®ÄÁöÑË°®Ëææ‰π†ÊÉØ„ÄÇÂè™ËøîÂõûÁøªËØëÁªìÊûú„ÄÇ',
                promptContentUI: '‰Ω†ÊòØ‰∏Ä‰∏™UI/UXÊñáÊ°à‰∏ìÂÆ∂„ÄÇËØ∑Â∞Ü‰ª•‰∏ãÁïåÈù¢ÊñáÊú¨ÁøªËØëÊàê{targetLanguage}ÔºåË¶ÅÊ±ÇÁÆÄÊ¥ÅÊòé‰∫ÜÔºåÁ¨¶ÂêàÁî®Êà∑ÁïåÈù¢ÁöÑË°®ËææËßÑËåÉ„ÄÇÂè™ËøîÂõûÁøªËØëÁªìÊûú„ÄÇ',
                promptContentTechnical: '‰Ω†ÊòØ‰∏Ä‰∏™ÊäÄÊúØÊñáÊ°£ÁøªËØë‰∏ìÂÆ∂„ÄÇËØ∑Â∞Ü‰ª•‰∏ãÊäÄÊúØÊñáÊú¨ÁøªËØëÊàê{targetLanguage}Ôºå‰øùÊåÅ‰∏ì‰∏öÊúØËØ≠ÁöÑÂáÜÁ°ÆÊÄß„ÄÇÂè™ËøîÂõûÁøªËØëÁªìÊûú„ÄÇ',

                // ÊàêÂäü/ÈîôËØØÊ∂àÊÅØ
                promptSaved: 'ÊèêÁ§∫ËØç "{name}" Â∑≤‰øùÂ≠ò',
                promptDeleted: 'ÊèêÁ§∫ËØç "{name}" Â∑≤Âà†Èô§',
                promptSavedFailed: 'ÊèêÁ§∫ËØçÂêçÁß∞ÂíåÂÜÖÂÆπ‰∏çËÉΩ‰∏∫Á©∫',
                modelSaved: 'Ê®°Âûã "{name}" Â∑≤‰øùÂ≠ò',
                modelDeleted: 'Ê®°Âûã "{name}" Â∑≤Âà†Èô§',
                modelSavedFailed: 'ËØ∑ÂÖàËæìÂÖ•Ê®°ÂûãÂêçÁß∞',
                modelSavedDuplicate: 'Ê®°Âûã "{name}" Â∑≤Â≠òÂú®',
                modelSwitched: 'Â∑≤ÂàáÊç¢Âà∞Ê®°Âûã: {modelName}',
                promptSwitched: 'Â∑≤ÂàáÊç¢ÊèêÁ§∫ËØçÊ®°Êùø',
                configSaved: 'ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò',
                languageSwitched: 'ÁõÆÊ†áËØ≠Ë®ÄÂ∑≤ÂàáÊç¢‰∏∫: {language}',
                translationStarted: 'ÂºÄÂßãÁøªËØë...',
                translationStopping: 'Ê≠£Âú®ÂÅúÊ≠¢ÁøªËØë...',
                translationStopped: 'ÁøªËØëÂ∑≤ÂÅúÊ≠¢ - Â∑≤ÂÆåÊàê {completed}/{total} ‰∏™ÊñáÊú¨',
                translationCompletedPartial: 'ÁøªËØëÂÆåÊàêÔºÅÂ∑≤ÂÆåÊàê {completed}/{total} ‰∏™ÊñáÊú¨ÔºàÈÉ®ÂàÜÂ§±Ë¥•Ôºâ',
                translationCompletedAll: 'ÁøªËØëÂÆåÊàêÔºÅÊâÄÊúâÊñáÊú¨ÁøªËØëÊàêÂäü',

                // ËøõÂ∫¶Ê∂àÊÅØËØ¶ÁªÜÁâàÊú¨
                progressProcessingDetail: 'Ê≠£Âú®Â§ÑÁêÜ ({completed}/{total}): {currentText}',
                progressTranslatingDetail: 'ÁøªËØëËøõÂ∫¶: {completed}/{total} ({progress}%) - Â∑≤ÂÆåÊàê: {currentText}',
                progressTranslatingSimple: 'ÁøªËØëËøõÂ∫¶: {completed}/{total} ({progress}%)',

                // ËØ≠Ë®ÄÂêçÁß∞
                languages: {
                    'zh-CN': 'ÁÆÄ‰Ωì‰∏≠Êñá',
                    'zh-TW': 'ÁπÅ‰Ωì‰∏≠Êñá',
                    'en': 'Ëã±ËØ≠',
                    'ja': 'Êó•ËØ≠',
                    'ko': 'Èü©ËØ≠',
                    'fr': 'Ê≥ïËØ≠',
                    'de': 'Âæ∑ËØ≠',
                    'es': 'Ë•øÁè≠ÁâôËØ≠',
                    'ru': '‰øÑËØ≠',
                    'ar': 'ÈòøÊãâ‰ºØËØ≠',
                    'pt': 'Ëë°ËêÑÁâôËØ≠',
                    'it': 'ÊÑèÂ§ßÂà©ËØ≠',
                    'nl': 'Ëç∑ÂÖ∞ËØ≠',
                    'sv': 'ÁëûÂÖ∏ËØ≠',
                    'da': '‰∏πÈ∫¶ËØ≠',
                    'no': 'Êå™Â®ÅËØ≠',
                    'fi': 'Ëä¨ÂÖ∞ËØ≠',
                    'pl': 'Ê≥¢ÂÖ∞ËØ≠',
                    'cs': 'Êç∑ÂÖãËØ≠',
                    'hu': 'ÂåàÁâôÂà©ËØ≠',
                    'tr': 'ÂúüËÄ≥ÂÖ∂ËØ≠',
                    'th': 'Ê≥∞ËØ≠',
                    'vi': 'Ë∂äÂçóËØ≠',
                    'hi': 'Âç∞Âú∞ËØ≠',
                    'he': 'Â∏å‰ºØÊù•ËØ≠',
                    'uk': '‰πåÂÖãÂÖ∞ËØ≠'
                }
            },

            'en': {
                // Main interface
                title: 'lumitrans Translator',
                settings: 'Settings',
                selectedText: 'text layers selected',
                targetLanguage: 'Target Language',
                model: 'Model',
                promptTemplate: 'Prompt Template',
                startTranslation: 'Start Translation',
                stopTranslation: 'Stop Translation',

                // Settings dialog
                apiUrl: 'API URL',
                apiKey: 'API Key',
                prompt: 'Prompt',
                save: 'Save',
                close: 'Close',

                // Language selection
                language: 'Interface Language',

                // Placeholders
                placeholderApiUrl: 'https://api.openai.com/v1/chat/completions',
                placeholderApiKey: 'sk-...',
                placeholderModel: 'gpt-4.1-nano',
                placeholderPrompt: 'You are a professional translator...',
                placeholderPromptName: 'Name this prompt...',

                // Status messages
                statusConfigNeeded: 'Please configure API settings first',
                statusConfigured: 'Configuration complete',
                statusTranslating: 'Translating...',
                statusCompleted: 'Translation completed!',
                statusStopping: 'Stopping translation...',
                statusError: 'Translation error',
                
                // API short statuses (added)
                statusApiTestingShort: 'Testing...',
                statusApiOkShort: 'Connected',
                statusApiNotConfiguredShort: 'Not configured',
                statusApiErrorShort: 'Failed',

                // Progress messages
                progressProcessing: 'Processing',
                progressTranslating: 'Translation progress',

                // Prompt templates
                templateStandard: 'Standard',
                templateLocalization: 'Localization',
                templateUI: 'UI Text',
                templateTechnical: 'Technical',

                // Prompt templates content
                promptContentStandard: 'You are a professional translator. Please translate the text provided by the user into {targetLanguage}. Return only the translation, without any explanation or other content.',
                promptContentLocalization: 'You are a professional localizer. Please translate the following text into {targetLanguage}, maintaining the original tone and style, so that it fits the expression habits of the target language. Return only the translation.',
                promptContentUI: 'You are a UI/UX copywriter. Please translate the following interface text into {targetLanguage}, keeping it simple and clear, to fit the expression norms of the user interface. Return only the translation.',
                promptContentTechnical: 'You are a technical document translator. Please translate the following technical text into {targetLanguage}, maintaining the accuracy of professional terms. Return only the translation.',

                // Success/Error messages
                promptSaved: 'Prompt saved',
                promptDeleted: 'Prompt deleted',
                promptSavedFailed: 'Prompt name and content cannot be empty',
                modelSaved: 'Model "{name}" saved',
                modelDeleted: 'Model "{name}" deleted',
                modelSavedFailed: 'Please enter a model name first',
                modelSavedDuplicate: 'Model "{name}" already exists',
                modelSwitched: 'Switched to model: {modelName}',
                promptSwitched: 'Switched prompt template',
                configSaved: 'Configuration saved',
                languageSwitched: 'Target language switched to: {language}',
                translationStarted: 'Translation started...',
                translationStopping: 'Stopping translation...',
                translationStopped: 'Translation stopped - Completed {completed}/{total} texts',
                translationCompletedPartial: 'Translation completed! Finished {completed}/{total} texts (some failed)',
                translationCompletedAll: 'Translation completed! All texts translated successfully',

                // Progress messages
                progressProcessingDetail: 'Processing ({completed}/{total}): {currentText}',
                progressTranslatingDetail: 'Translation progress: {completed}/{total} ({progress}%) - Completed: {currentText}',
                progressTranslatingSimple: 'Translation progress: {completed}/{total} ({progress}%)',

                // Language names
                languages: {
                    'zh-CN': 'Simplified Chinese',
                    'zh-TW': 'Traditional Chinese',
                    'en': 'English',
                    'ja': 'Japanese',
                    'ko': 'Korean',
                    'fr': 'French',
                    'de': 'German',
                    'es': 'Spanish',
                    'ru': 'Russian',
                    'ar': 'Arabic',
                    'pt': 'Portuguese',
                    'it': 'Italian',
                    'nl': 'Dutch',
                    'sv': 'Swedish',
                    'da': 'Danish',
                    'no': 'Norwegian',
                    'fi': 'Finnish',
                    'pl': 'Polish',
                    'cs': 'Czech',
                    'hu': 'Hungarian',
                    'tr': 'Turkish',
                    'th': 'Thai',
                    'vi': 'Vietnamese',
                    'hi': 'Hindi',
                    'he': 'Hebrew',
                    'uk': 'Ukrainian'
                }
            },

            'ja': {
                // „É°„Ç§„É≥„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ
                title: 'lumitransÁøªË®≥„Ç¢„Ç∑„Çπ„Çø„É≥„Éà',
                settings: 'Ë®≠ÂÆö',
                selectedText: '„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„É¨„Ç§„É§„Éº„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åô',
                targetLanguage: 'ÁøªË®≥ÂÖàË®ÄË™û',
                model: '„É¢„Éá„É´',
                promptTemplate: '„Éó„É≠„É≥„Éó„Éà„ÉÜ„É≥„Éó„É¨„Éº„Éà',
                startTranslation: 'ÁøªË®≥ÈñãÂßã',
                stopTranslation: 'ÁøªË®≥ÂÅúÊ≠¢',

                // Ë®≠ÂÆö„ÉÄ„Ç§„Ç¢„É≠„Ç∞
                apiUrl: 'API URL',
                apiKey: 'API „Ç≠„Éº',
                prompt: '„Éó„É≠„É≥„Éó„Éà',
                save: '‰øùÂ≠ò',
                close: 'Èñâ„Åò„Çã',

                // Ë®ÄË™ûÈÅ∏Êäû
                language: '„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„ÇπË®ÄË™û',

                // „Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº
                placeholderApiUrl: 'https://api.openai.com/v1/chat/completions',
                placeholderApiKey: 'sk-...',
                placeholderModel: 'gpt-4.1-nano',
                placeholderPrompt: '„ÅÇ„Å™„Åü„ÅØÂ∞ÇÈñÄÁöÑ„Å™ÁøªË®≥ËÄÖ„Åß„Åô...',
                placeholderPromptName: '„Åì„ÅÆ„Éó„É≠„É≥„Éó„Éà„Å´ÂêçÂâç„Çí‰ªò„Åë„Çã...',

                // „Çπ„ÉÜ„Éº„Çø„Çπ„É°„ÉÉ„Çª„Éº„Ç∏
                statusConfigNeeded: '„Åæ„ÅöAPIË®≠ÂÆö„ÇíÊßãÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
                statusConfigured: 'Ë®≠ÂÆöÂÆå‰∫Ü',
                statusTranslating: 'ÁøªË®≥‰∏≠...',
                statusCompleted: 'ÁøªË®≥ÂÆå‰∫ÜÔºÅ',
                statusStopping: 'ÁøªË®≥„ÇíÂÅúÊ≠¢‰∏≠...',
                statusError: 'ÁøªË®≥„Ç®„É©„Éº',
                
                // APIÁü≠„ÅÑË°®Á§∫ÔºàËøΩÂä†Ôºâ
                statusApiTestingShort: '„ÉÜ„Çπ„Éà‰∏≠...',
                statusApiOkShort: 'Êé•Á∂öÊ∏à„Åø',
                statusApiNotConfiguredShort: 'Êú™Ë®≠ÂÆö',
                statusApiErrorShort: 'Â§±Êïó',

                // „Éó„É≠„Ç∞„É¨„Çπ„É°„ÉÉ„Çª„Éº„Ç∏
                progressProcessing: 'Âá¶ÁêÜ‰∏≠',
                progressTranslating: 'ÁøªË®≥ÈÄ≤Ë°åÁä∂Ê≥Å',

                // „Éó„É≠„É≥„Éó„Éà„ÉÜ„É≥„Éó„É¨„Éº„Éà
                templateStandard: 'Ê®ôÊ∫ñÁøªË®≥',
                templateLocalization: '„É≠„Éº„Ç´„É©„Ç§„Çº„Éº„Ç∑„Éß„É≥',
                templateUI: 'UI„ÉÜ„Ç≠„Çπ„Éà',
                templateTechnical: 'ÊäÄË°ìÊñáÊõ∏',

                // Prompt templates content
                promptContentStandard: '„ÅÇ„Å™„Åü„ÅØÂ∞ÇÈñÄÁöÑ„Å™ÁøªË®≥ËÄÖ„Åß„Åô„ÄÇ„É¶„Éº„Ç∂„Éº„Åã„ÇâÊèê‰æõ„Åï„Çå„Åü„ÉÜ„Ç≠„Çπ„Éà„Çí{targetLanguage}„Å´ÁøªË®≥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÁøªË®≥ÁµêÊûú„ÅÆ„Åø„ÇíËøî„Åó„ÄÅË™¨Êòé„ÇÑ„Åù„ÅÆ‰ªñ„ÅÆÂÜÖÂÆπ„ÅØËøΩÂä†„Åó„Å™„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ',
                promptContentLocalization: '„ÅÇ„Å™„Åü„ÅØÂ∞ÇÈñÄÁöÑ„Å™„É≠„Éº„Ç´„É©„Ç§„Ç∂„Éº„Åß„Åô„ÄÇ‰ª•‰∏ã„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Çí{targetLanguage}„Å´ÁøªË®≥„Åó„ÄÅÂéüÊñá„ÅÆ„Éà„Éº„É≥„Å®„Çπ„Çø„Ç§„É´„ÇíÁ∂≠ÊåÅ„Åó„Å¶„ÄÅ„Åù„ÅÆË®ÄË™û„ÅÆË°®ÁèæÁøíÊÖ£„Å´Âêà„Çè„Åõ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÁøªË®≥ÁµêÊûú„ÅÆ„Åø„ÇíËøî„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                promptContentUI: '„ÅÇ„Å™„Åü„ÅØUI/UX„Ç≥„Éî„Éº„É©„Ç§„Çø„Éº„Åß„Åô„ÄÇ‰ª•‰∏ã„ÅÆ„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ„ÉÜ„Ç≠„Çπ„Éà„Çí{targetLanguage}„Å´ÁøªË®≥„Åó„ÄÅ„Ç∑„É≥„Éó„É´„ÅßÊòéÁ¢∫„Å™Ë°®Áèæ„Å´„Åó„Å¶„ÄÅ„É¶„Éº„Ç∂„Éº„ÅÆ„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ„ÅÆË°®ÁèæË¶èÁØÑ„Å´Âêà„Çè„Åõ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÁøªË®≥ÁµêÊûú„ÅÆ„Åø„ÇíËøî„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                promptContentTechnical: '„ÅÇ„Å™„Åü„ÅØÊäÄË°ìÊñáÊõ∏ÁøªË®≥Â∞ÇÈñÄÂÆ∂„Åß„Åô„ÄÇ‰ª•‰∏ã„ÅÆÊäÄË°ì„ÉÜ„Ç≠„Çπ„Éà„Çí{targetLanguage}„Å´ÁøªË®≥„Åó„ÄÅÂ∞ÇÈñÄÁî®Ë™û„ÅÆÊ≠£Á¢∫ÊÄß„ÇíÁ∂≠ÊåÅ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÁøªË®≥ÁµêÊûú„ÅÆ„Åø„ÇíËøî„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',

                // ÊàêÂäü/„Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏
                promptSaved: '„Éó„É≠„É≥„Éó„Éà„Åå‰øùÂ≠ò„Åï„Çå„Åæ„Åó„Åü',
                promptDeleted: '„Éó„É≠„É≥„Éó„Éà„ÅåÂâäÈô§„Åï„Çå„Åæ„Åó„Åü',
                promptSavedFailed: '„Éó„É≠„É≥„Éó„Éà„ÅÆÂêçÂâç„Å®ÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
                modelSaved: '„É¢„Éá„É´"{name}"„Åå‰øùÂ≠ò„Åï„Çå„Åæ„Åó„Åü',
                modelDeleted: '„É¢„Éá„É´"{name}"„ÅåÂâäÈô§„Åï„Çå„Åæ„Åó„Åü',
                modelSavedFailed: '„Åæ„Åö„É¢„Éá„É´„ÅÆÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
                modelSavedDuplicate: '„É¢„Éá„É´"{name}"„ÅØÊó¢„Å´Â≠òÂú®„Åó„Åæ„Åô',
                modelSwitched: '„É¢„Éá„É´: {modelName}„Å´Âàá„ÇäÊõø„Åà„Åæ„Åó„Åü',
                promptSwitched: '„Éó„É≠„É≥„Éó„Éà„ÉÜ„É≥„Éó„É¨„Éº„Éà„ÇíÂàá„ÇäÊõø„Åà„Åæ„Åó„Åü',
                configSaved: 'Ë®≠ÂÆö„Åå‰øùÂ≠ò„Åï„Çå„Åæ„Åó„Åü',
                languageSwitched: 'ÂØæË±°Ë®ÄË™û„Åå{language}„Å´Âàá„ÇäÊõø„Åà„Åæ„Åó„Åü',
                translationStarted: 'ÁøªË®≥ÈñãÂßã...',
                translationStopping: 'ÁøªË®≥„ÇíÂÅúÊ≠¢‰∏≠...',
                translationStopped: 'ÁøªË®≥„ÅåÂÅúÊ≠¢„Åï„Çå„Åæ„Åó„Åü - {completed}/{total}ÂÄã„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„ÅåÂÆå‰∫Ü',
                translationCompletedPartial: 'ÁøªË®≥ÂÆå‰∫ÜÔºÅ{completed}/{total}ÂÄã„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„ÅåÂÆå‰∫ÜÔºà‰∏ÄÈÉ®Â§±ÊïóÔºâ',
                translationCompletedAll: 'ÁøªË®≥ÂÆå‰∫ÜÔºÅ„Åô„Åπ„Å¶„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„ÅåÊ≠£Â∏∏„Å´ÁøªË®≥„Åï„Çå„Åæ„Åó„Åü',

                // „Éó„É≠„Ç∞„É¨„Çπ„É°„ÉÉ„Çª„Éº„Ç∏Ë©≥Á¥∞Áâà
                progressProcessingDetail: 'Âá¶ÁêÜ‰∏≠ ({completed}/{total}): {currentText}',
                progressTranslatingDetail: 'ÁøªË®≥ÈÄ≤Ë°åÁä∂Ê≥Å: {completed}/{total} ({progress}%) - ÂÆå‰∫Ü: {currentText}',
                progressTranslatingSimple: 'ÁøªË®≥ÈÄ≤Ë°åÁä∂Ê≥Å: {completed}/{total} ({progress}%)',

                // Ë®ÄË™ûÂêç
                languages: {
                    'zh-CN': 'Á∞°‰ΩìÂ≠ó‰∏≠ÂõΩË™û',
                    'zh-TW': 'ÁπÅ‰ΩìÂ≠ó‰∏≠ÂõΩË™û',
                    'en': 'Ëã±Ë™û',
                    'ja': 'Êó•Êú¨Ë™û',
                    'ko': 'ÈüìÂõΩË™û',
                    'fr': '„Éï„É©„É≥„ÇπË™û',
                    'de': '„Éâ„Ç§„ÉÑË™û',
                    'es': '„Çπ„Éö„Ç§„É≥Ë™û',
                    'ru': '„É≠„Ç∑„Ç¢Ë™û',
                    'ar': '„Ç¢„É©„Éì„Ç¢Ë™û',
                    'pt': '„Éù„É´„Éà„Ç¨„É´Ë™û',
                    'it': '„Ç§„Çø„É™„Ç¢Ë™û',
                    'nl': '„Ç™„É©„É≥„ÉÄË™û',
                    'sv': '„Çπ„Ç¶„Çß„Éº„Éá„É≥Ë™û',
                    'da': '„Éá„É≥„Éû„Éº„ÇØË™û',
                    'no': '„Éé„É´„Ç¶„Çß„ÉºË™û',
                    'fi': '„Éï„Ç£„É≥„É©„É≥„ÉâË™û',
                    'pl': '„Éù„Éº„É©„É≥„ÉâË™û',
                    'cs': '„ÉÅ„Çß„Ç≥Ë™û',
                    'hu': '„Éè„É≥„Ç¨„É™„ÉºË™û',
                    'tr': '„Éà„É´„Ç≥Ë™û',
                    'th': '„Çø„Ç§Ë™û',
                    'vi': '„Éô„Éà„Éä„É†Ë™û',
                    'hi': '„Éí„É≥„Éá„Ç£„ÉºË™û',
                    'he': '„Éò„Éñ„É©„Ç§Ë™û',
                    'uk': '„Ç¶„ÇØ„É©„Ç§„ÉäË™û'
                }
            }
        };

        // ÂΩìÂâçËØ≠Ë®ÄËÆæÁΩÆ
        let currentUILanguage = 'zh-CN';

        // i18n ÂäüËÉΩ
        function t(key, replacements = {}) {
            const keys = key.split('.');
            let value = i18nData[currentUILanguage];

            for (const k of keys) {
                if (value && typeof value === 'object') {
                    value = value[k];
                } else {
                    break;
                }
            }

            if (typeof value !== 'string') {
                // ÂõûÈÄÄÂà∞‰∏≠Êñá
                value = i18nData['zh-CN'];
                for (const k of keys) {
                    if (value && typeof value === 'object') {
                        value = value[k];
                    } else {
                        break;
                    }
                }
            }

            if (typeof value === 'string') {
                // ÊõøÊç¢Âç†‰ΩçÁ¨¶
                return value.replace(/\{(\w+)\}/g, (match, key) => {
                    return replacements[key] !== undefined ? replacements[key] : match;
                });
            }

            return key; // Â¶ÇÊûúÊâæ‰∏çÂà∞ÁøªËØëÔºåËøîÂõûÈîÆÂêç
        }

        // Êõ¥Êñ∞ÁïåÈù¢ËØ≠Ë®Ä
        function updateUILanguage() {
            // Êõ¥Êñ∞È°µÈù¢Ê†áÈ¢ò
            document.title = t('title');

            // Êõ¥Êñ∞ÊâÄÊúâÂ∏¶Êúâ data-i18n Â±ûÊÄßÁöÑÂÖÉÁ¥†
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                element.textContent = t(key);
            });

            // Êõ¥Êñ∞ÊâÄÊúâÂ∏¶Êúâ data-i18n-placeholder Â±ûÊÄßÁöÑÂÖÉÁ¥†
            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                element.placeholder = t(key);
            });

            // Êõ¥Êñ∞ÊâÄÊúâÂ∏¶Êúâ data-i18n-title Â±ûÊÄßÁöÑÂÖÉÁ¥†
            document.querySelectorAll('[data-i18n-title]').forEach(element => {
                const key = element.getAttribute('data-i18n-title');
                element.title = t(key);
            });

            // Êõ¥Êñ∞ÁøªËØëÁõÆÊ†áËØ≠Ë®Ä‰∏ãÊãâÊ°ÜÁöÑÈÄâÈ°πÊñáÊú¨
            const targetLanguageSelect = document.getElementById('targetLanguage');
            if (targetLanguageSelect) {
                targetLanguageSelect.querySelectorAll('option').forEach(option => {
                    const langKey = option.value;
                    if (langKey && t('languages.' + langKey)) {
                        const flag = option.textContent.match(/üá®üá≥|üáπüáº|üá∫üá∏|üáØüáµ|üá∞üá∑|üá´üá∑|üá©üá™|üá™üá∏|üá∑üá∫|üá∏üá¶|üáµüáπ|üáÆüáπ|üá≥üá±|üá∏üá™|üá©üá∞|üá≥üá¥|üá´üáÆ|üáµüá±|üá®üáø|üá≠üá∫|üáπüá∑|üáπüá≠|üáªüá≥|üáÆüá≥|üáÆüá±|üá∫üá¶/);
                        const flagText = flag ? ' ' + flag[0] : '';
                        option.textContent = t('languages.' + langKey) + flagText;
                    }
                });
            }

            // Êõ¥Êñ∞Âø´ÈÄüÊèêÁ§∫ËØçÈÄâÊã©Ê°ÜÁöÑÈÄâÈ°πÊñáÊú¨
            const quickPromptSelect = document.getElementById('quickPromptSelect');
            if (quickPromptSelect) {
                quickPromptSelect.querySelectorAll('option').forEach(option => {
                    const value = option.value;
                    if (value && !value.startsWith('custom_')) {
                        // Êõ¥Êñ∞È¢ÑËÆæÊèêÁ§∫ËØçÈÄâÈ°πÁöÑÊñáÊú¨
                        const templateNames = {
                            'standard': 'templateStandard',
                            'localization': 'templateLocalization',
                            'ui': 'templateUI',
                            'technical': 'templateTechnical'
                        };
                        if (templateNames[value]) {
                            option.textContent = t(templateNames[value]);
                        }
                    }
                });
            }

            // Êõ¥Êñ∞ËÆæÁΩÆÂºπÁ™ó‰∏≠ÁöÑÊèêÁ§∫ËØçÊ®°ÊùøÂÜÖÂÆπ
            const promptTags = document.querySelectorAll('.prompt-templates .prompt-tag:not(.custom-prompt-tag)');
            promptTags.forEach(tag => {
                // Ê†πÊçÆdata-template-typeÂ±ûÊÄßÁ°ÆÂÆöÊ®°ÊùøÁ±ªÂûã
                const templateType = tag.getAttribute('data-template-type');
                const promptContentKeys = {
                    'standard': 'promptContentStandard',
                    'localization': 'promptContentLocalization',
                    'ui': 'promptContentUI',
                    'technical': 'promptContentTechnical'
                };

                if (promptContentKeys[templateType]) {
                    const newPromptContent = t(promptContentKeys[templateType]);
                    tag.setAttribute('data-prompt', newPromptContent);
                }
            });
        }

        // ÂàùÂßãÂåñËØ≠Ë®ÄËÆæÁΩÆ
        async function initLanguage() {
            // ‰ªéÂ≠òÂÇ®‰∏≠Âä†ËΩΩËØ≠Ë®ÄËÆæÁΩÆ
            try {
                const savedLanguage = localStorage.getItem('ui-language');
                if (savedLanguage && i18nData[savedLanguage]) {
                    currentUILanguage = savedLanguage;
                }
            } catch (e) {
                console.log('Could not load language setting:', e);
            }

            // ËÆæÁΩÆUIËØ≠Ë®ÄÈÄâÊã©Ê°ÜÁöÑÂÄº
            const uiLanguageSelect = document.getElementById('uiLanguage');
            if (uiLanguageSelect) {
                uiLanguageSelect.value = currentUILanguage;
            }

            updateUILanguage();

            // Á°Æ‰øù‰∏ãÊãâÊ°ÜÈÄâÈ°πÊñáÊú¨‰πüÂæóÂà∞Êõ¥Êñ∞
            setTimeout(() => {
                if (typeof renderQuickPromptSelect === 'function') {
                    renderQuickPromptSelect();
                }
                // ÂàùÂßãÂåñÂÆåÊàêÂêéË∞ÉÊï¥È´òÂ∫¶
                adjustUIHeight();
            }, 100);
        }

        // ÂàáÊç¢ËØ≠Ë®Ä
        function changeLanguage(language) {
            if (i18nData[language]) {
                currentUILanguage = language;
                try {
                    localStorage.setItem('ui-language', language);
                } catch (e) {
                    console.log('Could not save language setting:', e);
                }
                updateUILanguage();

                // Êõ¥Êñ∞ËØ≠Ë®Ä‰∏ãÊãâÊ°ÜÁöÑÈÄâ‰∏≠Áä∂ÊÄÅ
                const langSelect = document.getElementById('uiLanguage');
                if (langSelect) {
                    langSelect.value = language;
                }

                // ËØ≠Ë®ÄÂàáÊç¢ÂêéË∞ÉÊï¥È´òÂ∫¶
                setTimeout(() => {
                    adjustUIHeight();
                }, 100);
            }
        }

        // ËÆ°ÁÆóÂπ∂Ë∞ÉÊï¥UIÈ´òÂ∫¶
        function adjustUIHeight() {
            try {
                // ËÆ°ÁÆóÂÆûÈôÖÂÜÖÂÆπÈ´òÂ∫¶
                const container = document.querySelector('.container');
                if (!container) return;

                // Ëé∑ÂèñÂÆπÂô®ÁöÑÂÆûÈôÖÈ´òÂ∫¶
                const containerHeight = container.scrollHeight;
                // Âä†‰∏äbodyÁöÑpaddingÔºà‰∏ä‰∏ãÂêÑ16pxÔºâ
                const totalHeight = containerHeight + 32;

                // ÈôêÂà∂È´òÂ∫¶ËåÉÂõ¥ÔºöÊúÄÂ∞è400pxÔºåÊúÄÂ§ß800px
                const clampedHeight = Math.min(Math.max(totalHeight, 400), 800);

                // ÂèëÈÄÅË∞ÉÊï¥È´òÂ∫¶ÁöÑÊ∂àÊÅØÁªô‰∏ªÁ∫øÁ®ã
                parent.postMessage({
                    pluginMessage: {
                        type: 'resize-ui',
                        width: 400,
                        height: clampedHeight
                    }
                }, '*');
            } catch (error) {
                console.log('Failed to adjust UI height:', error);
            }
        }
    </script>

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            scrollbar-width: none;
        }

        body {
            display: flex;
            flex-direction: column;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 12px;
            line-height: 1.4;
            box-sizing: border-box;
            background-color: #f3f3f3;

        }

        .container {
            min-height: 550px;
            display: flex;
            border-radius: 8px;
            gap: 6px;
            padding: 8px;
            flex-direction: column;
            scrollbar-width: none;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: #ffffff;
            border-radius: 8px;
            padding: 16px;
        }

        .info-row {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 12px;
            border-radius: 4px;
            background-color: #fff1f1;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .title {
            font-size: 14px;
            font-weight: 600;
            color: #1a1a1a;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-btn {
            border: 0px solid #dee2e6;
            border-radius: 0;
            padding: 4px 4px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            color: #666;
        }

        .settings-btn:hover {
            background: #e9ecef;
            color: #333;
        }

        .settings-btn.active {
            background: #007AFF;
            color: rgb(80, 80, 80);
            border-color: #007AFF;
        }

        .form-group {
            display: flex;
            justify-content: space-between;
            flex-direction: row;
            margin-bottom: 12px;
        }

        .form-group label {
            padding-top: 4px !important;
            width: 80px !important;
        }

        .form-group-column {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
            width: 100% !important;
        }

        h2 {
            font-size: 16px;
            font-weight: 600;
            color: #1a1a1a;
            border-bottom: 2px solid #007AFF;
            padding-bottom: 8px;
        }

        label {
            display: block;
            font-weight: 500;
            color: #555;
            font-size: 13px;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
            transition: border-color 0.2s;
        }

        /* ‰ºòÂåñ‰∏ãÊãâÂàóË°®Ê†∑Âºè */
        select {
            background: white;
            padding: 10px 36px 10px 12px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: none;
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            cursor: pointer;
            font-weight: 500;
            border: none;
            background: transparent;
            box-shadow: none;
        }

        select:hover {
            border-color: #007AFF;
            background-image: none;
        }

        select:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow: none;
            background-image: none;
        }

        /* ‰∏ãÊãâÈÄâÈ°πÊ†∑Âºè */
        select option {
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 400;
            background: white;
            color: #333;
            text-align: center;
        }

        select option:hover {
            background: #f8f9fa;
        }

        select option:checked {
            background: #007AFF;
            color: white;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
            line-height: 1.4;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.1);
        }

        /* Ë°®ÂçïÂÆπÂô®Ê†∑Âºè‰ºòÂåñ */
        .select-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .select-icon {
            position: absolute;
            left: 12px;
            color: #666;
            pointer-events: none;
            z-index: 1;
        }

        .select-container select {
            padding: 8px 4px;
        }

        .select-container:hover .select-icon {
            color: #007AFF;
        }

        .select-container select:focus+.select-icon,
        .select-container select:focus~.select-icon {
            color: #007AFF;
        }

        .btn {
            display: inline-block;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            width: 100%;
            padding: 12px 20px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #002fff 0%, #8000ff 25%, #e600ff 50%, #ff0022 75%, #ffc400 100%);
            background-size: 200% 200%;
            color: white;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: medium;
            animation: gradientShift 3s ease infinite;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            border: none;
            border-radius: 50px;
            transition: all 0.3s ease;
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #002fff 0%, #8000ff 25%, #e600ff 50%, #ff0022 75%, #ffc400 100%);
            background-size: 200% 200%;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
            animation: gradientShift 2s ease infinite;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            font-size: 16px;
            border-radius: 50px;
            padding: 14px 24px;
        }

        .btn-danger:hover:not(:disabled) {
            background: #c82333;
        }

        .btn-secondary {
            background: #f1f3f5;
            color: #495057;
            border: 1px solid #dee2e6;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #2c99ff;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .status {
            padding: 8px 12px;
            border-radius: 6px;
            margin: 12px 0;
            font-size: 11px;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #99d5ff;
        }

        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .progress {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin: 16px 0;
        }

        .progress-bar {
            height: 100%;
            background: #007AFF;
            transition: width 0.3s ease;
            width: 0%;
        }

        .section {
            padding-bottom: 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .section:last-child {
            border-bottom: none;
        }

        .help-text {
            font-size: 10px;
            color: #666;
            margin-top: 4px;
        }

        .loading {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .spinner {
            width: 14px;
            height: 14px;
            border: 2px solid #e9ecef;
            border-top: 2px solid #007AFF;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .hidden {
            display: none;
        }

        /* Material Symbols Ê†∑Âºè */
        .material-symbols-outlined {
            font-family: 'Material Symbols Outlined';
            font-weight: normal;
            font-style: normal;
            font-size: 18px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
        }

        .icon-small {
            font-size: 16px;
        }

        .icon-large {
            font-size: 20px;
        }

        /* ËÆæÁΩÆÂºπÁ™óÊ†∑Âºè */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            min-height: 300px;
            max-height: 85vh;
            height: auto;
            overflow: hidden;
            /* Êîπ‰∏∫hiddenÔºåËÆ©ÂÜÖÈÉ®ÊéßÂà∂ÊªöÂä® */
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            transform: scale(0.7);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .modal-overlay.show .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            border-bottom: 1px solid #e9ecef;
            flex-shrink: 0;
            /* Èò≤Ê≠¢Êî∂Áº© */
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .close-btn {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            
        }
        .close-btn .material-symbols-outlined{
            font-size: 24px;
        }
        .close-btn:hover {
            color: #333;
        }

        .modal-body {
            padding: 12px;
            /* ÂáèÂ∞ëÂ∫ïÈÉ®ÂÜÖËæπË∑ù */
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }

        /* Êñ∞Â¢ûÔºöÊ®°ÊÄÅÊ°ÜÂ∫ïÈÉ®Âõ∫ÂÆöÂå∫Âüü */
        .modal-footer {
            padding: 4px 4px;
            background: transparent;
            flex-shrink: 0;
        }

        .modal-footer .btn {
            width: 100%;
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            padding: 12px 24px;
            background: linear-gradient(135deg, #002fff 0%, #8000ff 25%, #e600ff 50%, #ff0022 75%, #ffc400 100%);
            color: white;
            border: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .modal-footer .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        /* ÁßªÈô§ÂéüÊù•modal-body‰∏≠ÁöÑÊåâÈíÆÊ†∑Âºè */
        .modal-body .btn {
            width: auto;
            margin-top: 0;
        }

        .config-status {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: #fff3cd;
            border-radius: 16px;
            font-size: 10px;
        }

        .config-status.configured {
            background: #d4edda;
            color: #155724;
        }

        .config-status.not-configured {
            background: #fff3cd;
            color: #856404;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #dc3545;
        }

        .status-indicator.configured {
            background: #28a745;
        }

        .model-info {
            display: none !important;
        }

        .language-section {
            background: none;
            border: none;
            border-radius: 0;
            padding: 0;
            margin: 0;
        }

        .language-title {
            font-size: 12px;
            font-weight: 600;
            color: #333;
            display: flex;
            margin-bottom: 8px;
            align-items: center;
            gap: 6px;
        }

        .information {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .selection-info {
            display: flex;
            align-items: center;
            gap: 8px;
            background: none;
            border: none;
            padding: 0;
            margin: 0;
        }

        .selection-count {
            font-size: 80px;
            font-weight: 100;
            color: #5e07ff;
        }

        .selection-text {
            font-size: 12px;
            color: #666;
        }

        .status-row {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .translate-section {
            display: flex;
            align-items: center;
        }

        .progress-info {
            text-align: center;
            margin: 8px 0;
            font-size: 12px;
            color: #666;
        }

        .btn-stop {
            background: #dc3545;
            color: white;
            font-size: 16px;
            padding: 14px 24px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .btn-stop:hover:not(:disabled) {
            background: #c82333;
        }

        .stop-spinner {
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .prompt-templates {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            background-color: white;
            border: none;
        }

        .prompt-tag {
            background: #e8f5e8;
            color: #2d5a2d;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .prompt-tag:hover {
            background: #d4edda;
            transform: translateY(-1px);
        }

        /* ‰øùÂ≠òËá™ÂÆö‰πâÊ®°ÊùøÊ†∑Âºè */
        .save-prompt-section {}

        .save-prompt-input {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .save-prompt-input input {
            flex-grow: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
        }

        .save-prompt-input input:focus {
            outline: none;
            border-color: #007AFF;
        }

        .btn-save-prompt {
            background: #007AFF;
            color: white;
            border: none;
            font-size: 12px;
            padding: 8px 12px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-save-prompt:hover:not(:disabled) {
            background: #0056CC;
        }

        .btn-save-prompt:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Ëá™ÂÆö‰πâÊèêÁ§∫ËØçÊ†∑Âºè */
        .custom-prompt-tag {
            background: #e0f2f7;
            color: #0056b3;
            padding: 2px 4px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 2px;
            position: relative;
        }

        .custom-prompt-tag:hover {
            background: #cce5ff;
            color: #0056b3;
            transform: translateY(-1px);
        }

        .delete-prompt {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 12px;
            height: 12px;
        }

        .delete-prompt:hover {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }

        .delete-prompt .material-symbols-outlined {
            font-size: 12px;
        }

        /* Ê®°ÂûãËæìÂÖ•ÂÆπÂô®Ê†∑Âºè */
        .model-input-container {
            display: flex;
            gap: 8px;
            width: 100% !important;
        }

        .model-input-container input {
            flex-grow: 1;

        }

        .btn-quick-save {
            background: #007AFF;
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .btn-quick-save:hover:not(:disabled) {
            background: #0056CC;
            transform: scale(1.05);
        }

        .btn-quick-save:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .model-templates {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .model-tag {
            background: #e8f5e8;
            color: #2d5a2d;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            position: relative;
        }

        .model-tag:hover {
            background: #d4edda;
            transform: translateY(-1px);
        }

        .delete-model {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 2px;
            border-radius: 50%;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            margin-left: 4px;
        }

        .delete-model:hover {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }

        .delete-model .material-symbols-outlined {
            font-size: 12px;
        }

        /* Ëá™ÂÆö‰πâÊ®°ÂûãÊ†áÁ≠æÊ†∑Âºè */
        .custom-model-tag {
            background: #fff3e0;
            color: #e65100;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            position: relative;
        }

        .custom-model-tag:hover {
            background: #ffe0b2;
            transform: translateY(-1px);
        }

        /* Âø´ÈÄüÂàáÊç¢Âå∫ÂüüÊ†∑Âºè */
        .quick-switch-section {
            display: flex;
            gap: 16px;
            padding: 0;
            background: none;
            border: none;
            border-radius: 0;
        }

        .quick-switch-item {
            flex: 1;
            text-align: left;
        }

        .quick-switch-title {
            font-size: 11px;
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* ‰∏ãÊãâÊ°ÜÂü∫Á°ÄÊ†∑Âºè */
        select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 8px 32px 8px 12px;
            font-size: 13px;
            color: #333;
            cursor: pointer;
            transition: all 0.2s ease;
            background-image: none;
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
        }

        select:hover {
            border-color: #adb5bd;
            background-color: #f1f3f5;
        }

        select:focus {
            outline: none;
            border-color: #4dabf7;
            box-shadow: none;
            background-color: #fff;
        }

        /* ‰∏ãÊãâÈÄâÈ°πÊ†∑Âºè */
        select option {
            background: #fff;
            color: #333;
            padding: 8px;
            font-size: 13px;
            border: none;
            text-align: center;
        }

        select option:hover {
            background: #e7f5ff;
        }

        select option:checked {
            background: #339af0;
            color: white;
        }

        /* Â∏¶ÂõæÊ†áÁöÑ‰∏ãÊãâÊ°ÜÂÆπÂô® */
        .select-container {
            position: relative;
            display: inline-flex;
            align-items: center;
            width: 100%;
        }

        .select-container select {
            width: 100%;
        }

        .select-icon {
            position: absolute;
            left: 10px;
            color: #666;
            pointer-events: none;
            z-index: 1;
        }

        .select-container:hover .select-icon {
            color: #333;
        }

        .select-container select:focus+.select-icon,
        .select-container select:focus~.select-icon {
            color: #339af0;
        }

        /* ÁïåÈù¢ËØ≠Ë®ÄÈÄâÊã©Âô®ÁâπÊÆäÊ†∑Âºè */
        #uiLanguage {
            width: 32px;
            padding-top: 12px;
            line-height: 1;
            padding: 0 0;
            font-size: 16px;
            color: rgb(99, 99, 99);
            opacity: 0.6;
            /* Èôç‰Ωé‰∏çÈÄèÊòéÂ∫¶ */
            text-align: center;
            background-image: none;
            /* ÁßªÈô§‰∏ãÊãâÁÆ≠Â§¥ */
            border: none;
            /* ÁßªÈô§ËæπÊ°Ü */
            background: transparent;
            /* ÁßªÈô§ËÉåÊôØËâ≤ */
        }

        #uiLanguage:hover,
        #uiLanguage:focus {
            background: transparent;
            /* ‰øùÊåÅÈÄèÊòéËÉåÊôØ */
            border: none;
            /* ‰øùÊåÅÊó†ËæπÊ°Ü */
            opacity: 1;
            /* ÊÇ¨ÂÅúÊó∂ÊòæÁ§∫ÂÆåÂÖ®‰∏çÈÄèÊòé */
            box-shadow: none;
            /* ÁßªÈô§ÁÑ¶ÁÇπÈò¥ÂΩ± */
        }

        #uiLanguage option {
            font-size: 16px;
            text-align: center;
            background: #ffffff;
            color: #757575;
        }

        .info-container {
            display: flex;
            justify-content: right;
            align-items: center;
            border-top: 1px solid rgb(207, 207, 207);
        }

        /* Êó•ÂøóÂõæÊ†áÊ†∑Âºè */
        .log-button {
            font-size: 16px;
            width: 32px;
            height: 32px;
            background-color: transparent;
            opacity: 0.6;
            /* Èôç‰Ωé‰∏çÈÄèÊòéÂ∫¶ */
            color: rgb(99, 99, 99);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: none;
            /* ÁßªÈô§Èò¥ÂΩ± */
            z-index: 2;
            transition: all 0.2s ease;
        }

        .log-button:hover {
            opacity: 1;
            /* ÊÇ¨ÂÅúÊó∂ÊòæÁ§∫ÂÆåÂÖ®‰∏çÈÄèÊòé */
        }

        .log-button .material-symbols-outlined {
            font-size: 16px;
        }

        /* ÁßªÈô§Êú™ËØªÊ∂àÊÅØÊ∞îÊ≥°Ê†∑Âºè */
        .log-button .badge {
            display: none;
        }

        /* Êó•ÂøóÂºπÁ™óÊ†∑Âºè */
        .log-modal {
            position: absolute;
            bottom: 20px;
            right: 8px;
            width: 280px;
            max-height: 360px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 999;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .log-modal.show {
            display: flex;
        }

        .log-header {
            padding: 12px 16px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .log-title {
            font-weight: 600;
            font-size: 14px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .log-content {
            padding: 12px;
            overflow-y: auto;
            flex: 1;
        }

        .log-entry {
            padding: 8px;
            margin-bottom: 8px;
            border-radius: 6px;
            font-size: 12px;
            line-height: 1.4;
        }

        .log-entry:last-child {
            margin-bottom: 0;
        }

        .log-entry.info {
            background: #e7f5ff;
            color: #004085;
        }

        .log-entry.success {
            background: #d4edda;
            color: #155724;
        }

        .log-entry.warning {
            background: #fff3cd;
            color: #856404;
        }

        .log-entry.error {
            background: #f8d7da;
            color: #721c24;
        }

        .log-entry .timestamp {
            font-size: 10px;
            color: #666;
            margin-bottom: 4px;
        }

        .log-actions {
            padding: 8px 16px;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
        }

        .log-actions button {
            border: none;
            background: none;
            color: #007AFF;
            cursor: pointer;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .log-actions button:hover {
            background: #f1f3f5;
        }

        /* Áé∞ÊúâÊ†∑Âºè‰∏ãÊñπË°•ÂÖÖAPIËøûÈÄöÊÄßÁä∂ÊÄÅÊ†∑Âºè */
        .config-status.testing {
            background: #cce7ff;
            color: #004085;
        }
        .config-status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .status-indicator.testing {
            background: #17a2b8; /* ËìùËâ≤ÔºåË°®Á§∫ÊµãËØï‰∏≠ */
        }
        .status-indicator.error {
            background: #dc3545; /* Á∫¢Ëâ≤ÔºåË°®Á§∫Â§±Ë¥• */
        }

        .github-button {
            width: 32px;
            height: 32px;
            background: transparent;
            border: none;
            color: rgb(99, 99, 99);
            opacity: 0.6;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 2;
        }
        .github-button:hover {
            opacity: 1;
        }
        .github-button svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        /* ÂØºÂÖ•/ÂØºÂá∫ÊåâÈíÆÊ†∑Âºè */
        .prompt-import-export {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e9ecef;
        }

        .import-export-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-import-export {
            background: #f8f9fa;
            color: #495057;
            border: 1px solid #dee2e6;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
            flex: 1;
            justify-content: center;
        }

        .btn-import-export:hover {
            background: #e9ecef;
            border-color: #adb5bd;
            color: #333;
        }

        .btn-import-export:active {
            transform: translateY(1px);
        }

        /* ÂØºÂÖ•ÊàêÂäü/Â§±Ë¥•ÊèêÁ§∫Ê†∑Âºè */
        .import-result {
            margin-top: 8px;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            display: none;
        }

        .import-result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .import-result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .import-result.info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #99d5ff;
        }

        /* APIÊµãËØïÊåâÈíÆÊ†∑Âºè */
        .test-api-btn {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            padding: 2px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            opacity: 0.7;
        }

        .test-api-btn:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.2);
        }

        .test-api-btn:active {
            transform: scale(0.95);
        }

        .test-api-btn .material-symbols-outlined {
            font-size: 12px;
        }

        /* ËÆæÁΩÆÈ°µÈù¢APIÊµãËØïÂå∫ÂüüÊ†∑Âºè */
        .api-test-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .btn-test-api {
            background: #007AFF;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            justify-content: center;
            width: fit-content;
        }

        .btn-test-api:hover:not(:disabled) {
            background: #0056CC;
            transform: translateY(-1px);
        }

        .btn-test-api:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-test-api.testing {
            background: #17a2b8;
        }

        .btn-test-api.testing .material-symbols-outlined {
            animation: spin 1s linear infinite;
        }

        .api-test-result {
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            display: none;
            border: 1px solid transparent;
        }

        .api-test-result.success {
            background: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }

        .api-test-result.error {
            background: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }

        .api-test-result.info {
            background: #cce7ff;
            color: #004085;
            border-color: #99d5ff;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Â§¥ÈÉ®Âå∫Âüü -->
        <div class="header">
            <div class="title">
                <img src="https://i.ibb.co/svMdf5c3/Lumitranslogo-4x.png" alt="lumitrans Logo"
                    style="width: 120px; height: 40px; object-fit: contain;">
            </div>
            <div style="display: flex; gap: 8px; align-items: center;">
                <!-- ËØ≠Ë®ÄÂàáÊç¢ -->
                <div class="status-row">
                    <!-- ÈÖçÁΩÆÁä∂ÊÄÅÊòæÁ§∫ -->
                    <div id="configStatus" class="config-status not-configured">
                        <div class="status-indicator" id="statusIndicator"></div>
                        <span id="statusText" data-i18n="statusConfigNeeded">ËØ∑ÂÖàÈÖçÁΩÆAPIËÆæÁΩÆ</span>
                    </div>
                    <div id="modelInfo" class="model-info hidden">
                        <span class="material-symbols-outlined icon-small">smart_toy</span>
                        <span id="currentModel">gpt-4.1-nano</span>
                    </div>
                </div>
                <button class="settings-btn" id="settingsToggle">
                    <span class="material-symbols-outlined icon-small">settings</span>
                </button>
            </div>
        </div>
        <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫ -->
        <div class="main-content">
            <!-- ‰ø°ÊÅØË°åÔºöÈÄâ‰∏≠ÊñáÊú¨Êï∞Èáè + Áä∂ÊÄÅ‰ø°ÊÅØ -->
            <div class="info-row">
                <div class="selection-count" id="selectionCount">0</div>
                <div class="selection-text" data-i18n="selectedText">‰∏™ÊñáÊú¨ÂõæÂ±ÇÂ∑≤ÈÄâ‰∏≠</div>
            </div>

            <!-- ÁõÆÊ†áËØ≠Ë®ÄÈÄâÊã© -->
            <div class="language-section">
                <div class="language-title">
                    <span data-i18n="targetLanguage">ÁøªËØëÁõÆÊ†áËØ≠Ë®Ä</span>
                </div>
                <div class="select-container">
                    <select id="targetLanguage">
                        <option value="zh-CN">ÁÆÄ‰Ωì‰∏≠Êñá üá®üá≥</option>
                        <option value="zh-TW">ÁπÅ‰Ωì‰∏≠Êñá üáπüáº</option>
                        <option value="en">Ëã±ËØ≠ üá∫üá∏</option>
                        <option value="ja">Êó•ËØ≠ üáØüáµ</option>
                        <option value="ko">Èü©ËØ≠ üá∞üá∑</option>
                        <option value="fr">Ê≥ïËØ≠ üá´üá∑</option>
                        <option value="de">Âæ∑ËØ≠ üá©üá™</option>
                        <option value="es">Ë•øÁè≠ÁâôËØ≠ üá™üá∏</option>
                        <option value="ru">‰øÑËØ≠ üá∑üá∫</option>
                        <option value="ar">ÈòøÊãâ‰ºØËØ≠ üá∏üá¶</option>
                        <option value="pt">Ëë°ËêÑÁâôËØ≠ üáµüáπ</option>
                        <option value="it">ÊÑèÂ§ßÂà©ËØ≠ üáÆüáπ</option>
                        <option value="nl">Ëç∑ÂÖ∞ËØ≠ üá≥üá±</option>
                        <option value="sv">ÁëûÂÖ∏ËØ≠ üá∏üá™</option>
                        <option value="da">‰∏πÈ∫¶ËØ≠ üá©üá∞</option>
                        <option value="no">Êå™Â®ÅËØ≠ üá≥üá¥</option>
                        <option value="fi">Ëä¨ÂÖ∞ËØ≠ üá´üáÆ</option>
                        <option value="pl">Ê≥¢ÂÖ∞ËØ≠ üáµüá±</option>
                        <option value="cs">Êç∑ÂÖãËØ≠ üá®üáø</option>
                        <option value="hu">ÂåàÁâôÂà©ËØ≠ üá≠üá∫</option>
                        <option value="tr">ÂúüËÄ≥ÂÖ∂ËØ≠ üáπüá∑</option>
                        <option value="th">Ê≥∞ËØ≠ üáπüá≠</option>
                        <option value="vi">Ë∂äÂçóËØ≠ üáªüá≥</option>
                        <option value="hi">Âç∞Âú∞ËØ≠ üáÆüá≥</option>
                        <option value="he">Â∏å‰ºØÊù•ËØ≠ üáÆüá±</option>
                        <option value="uk">‰πåÂÖãÂÖ∞ËØ≠ üá∫üá¶</option>
                    </select>
                </div>
            </div>

            <!-- Âø´ÈÄüÂàáÊç¢Âå∫Âüü -->
            <div class="quick-switch-section">
                <!-- Ê®°ÂûãÂø´ÈÄüÂàáÊç¢ -->
                <div class="quick-switch-item">
                    <div class="quick-switch-title">
                        <span data-i18n="model">Ê®°Âûã</span>
                    </div>
                    <div class="select-container">
                        <select id="quickModelSelect">
                            <option value="gpt-4.1-nano">gpt-4.1-nano</option>
                            <!-- Ëá™ÂÆö‰πâÊ®°ÂûãÈÄâÈ°πÂ∞ÜÂä®ÊÄÅÊèíÂÖ• -->
                        </select>
                    </div>
                </div>

                <!-- ÊèêÁ§∫ËØçÊ®°ÊùøÂø´ÈÄüÂàáÊç¢ -->
                <div class="quick-switch-item">
                    <div class="quick-switch-title">
                        <span data-i18n="promptTemplate">ÊèêÁ§∫ËØçÊ®°Êùø</span>
                    </div>
                    <div class="select-container">
                        <select id="quickPromptSelect">
                            <option value="standard" data-i18n="templateStandard">Ê†áÂáÜÁøªËØë</option>
                            <option value="localization" data-i18n="templateLocalization">Êú¨Âú∞Âåñ</option>
                            <option value="ui" data-i18n="templateUI">ÁïåÈù¢ÊñáÊ°à</option>
                            <option value="technical" data-i18n="templateTechnical">ÊäÄÊúØÊñáÊ°£</option>
                            <!-- Ëá™ÂÆö‰πâÊèêÁ§∫ËØçÈÄâÈ°πÂ∞ÜÂä®ÊÄÅÊèíÂÖ• -->
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÁøªËØëÈÉ®ÂàÜ -->
        <div class="translate-section">
            <button class="btn btn-primary" id="translateBtn" disabled>
                <span data-i18n="startTranslation">ÂºÄÂßãÁøªËØë</span>
            </button>
        </div>

        <div id="progress" class="progress hidden">
            <div id="progressBar" class="progress-bar"></div>
        </div>
        <div id="progressInfo" class="progress-info hidden"></div>
        <!-- Áä∂ÊÄÅÊòæÁ§∫ -->
        <div id="status"></div>
    </div>

    <!-- ËÆæÁΩÆÂºπÁ™ó -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-symbols-outlined">settings</span>
                    <span data-i18n="settings">ËÆæÁΩÆ</span>
                </div>
                <button class="close-btn" id="closeModal">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="apiUrl" data-i18n="apiUrl">APIÂú∞ÂùÄ</label>
                    <input type="text" id="apiUrl" data-i18n-placeholder="placeholderApiUrl"
                        placeholder="https://api.openai.com/v1/chat/completions">
                </div>

                <div class="form-group">
                    <label for="apiKey" data-i18n="apiKey">APIÂØÜÈí•</label>
                    <input type="password" id="apiKey" data-i18n-placeholder="placeholderApiKey" placeholder="sk-...">
                </div>

                <div class="form-group">
                    <label for="modelName" data-i18n="model">Ê®°Âûã</label>
                    <div class="form-group-column">
                        <div class="model-input-container">
                            <input type="text" id="modelName" data-i18n-placeholder="placeholderModel"
                                placeholder="gpt-4.1-nano">
                            <button class="btn-quick-save" id="quickSaveModelBtn" data-i18n-title="save" title="‰øùÂ≠òÂΩìÂâçÊ®°Âûã">
                                <span class="material-symbols-outlined icon-small">add</span>
                            </button>
                        </div>
                        <div class="model-templates">
                            <!-- Ëá™ÂÆö‰πâÊ®°ÂûãÂ∞ÜÂä®ÊÄÅÊèíÂÖ•Âà∞ËøôÈáå -->
                        </div>
                    </div>

                </div>

                <!-- APIÊµãËØïÂå∫Âüü -->
                <div class="form-group">
                    <label>APIËøûÈÄöÊÄßÊµãËØï</label>
                    <div class="api-test-section">
                        <button class="btn-test-api" id="testApiBtn" type="button">
                            <span class="material-symbols-outlined icon-small">wifi_tethering</span>
                            <span>ÊµãËØïËøûÊé•</span>
                        </button>
                        <div id="apiTestResult" class="api-test-result"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="customPrompt" data-i18n="prompt">ÊèêÁ§∫ËØç</label>

                    <div class="form-group-column">
                        <div class="save-prompt-section">
                            <div class="save-prompt-input">
                                <input type="text" id="promptName" data-i18n-placeholder="placeholderPromptName"
                                    placeholder="‰∏∫Ê≠§ÊèêÁ§∫ËØçÂëΩÂêç..." maxlength="20">
                                <button class="btn-quick-save" id="savePromptBtn">
                                    <span class="material-symbols-outlined icon-small">bookmark_add</span>
                                </button>
                            </div>
                        </div>
                        <textarea id="customPrompt" data-i18n-placeholder="placeholderPrompt"
                            placeholder="‰Ω†ÊòØ‰∏Ä‰∏™‰∏ì‰∏öÁöÑÁøªËØëÂä©Êâã..."></textarea>

                        <!-- ‰øùÂ≠òËá™ÂÆö‰πâÊ®°ÊùøÂå∫Âüü -->
                        <div class="prompt-templates">
                            <span class="prompt-tag" data-template-type="standard"
                                data-prompt="‰Ω†ÊòØ‰∏Ä‰∏™‰∏ì‰∏öÁöÑÁøªËØëÂä©Êâã„ÄÇËØ∑Â∞ÜÁî®Êà∑Êèê‰æõÁöÑÊñáÊú¨ÁøªËØëÊàê{targetLanguage}„ÄÇÂè™ËøîÂõûÁøªËØëÁªìÊûúÔºå‰∏çË¶ÅÊ∑ªÂä†‰ªª‰ΩïËß£ÈáäÊàñÂÖ∂‰ªñÂÜÖÂÆπ„ÄÇ"
                                data-i18n="templateStandard">Ê†áÂáÜ</span>
                            <span class="prompt-tag" data-template-type="localization"
                                data-prompt="‰Ω†ÊòØ‰∏Ä‰∏™‰∏ì‰∏öÁöÑÊú¨Âú∞Âåñ‰∏ìÂÆ∂„ÄÇËØ∑Â∞Ü‰ª•‰∏ãÊñáÊú¨ÁøªËØëÊàê{targetLanguage}Ôºå‰øùÊåÅÂéüÊñáÁöÑËØ≠Ê∞îÂíåÈ£éÊ†ºÔºå‰ΩøÂÖ∂Á¨¶ÂêàÁõÆÊ†áËØ≠Ë®ÄÁöÑË°®Ëææ‰π†ÊÉØ„ÄÇÂè™ËøîÂõûÁøªËØëÁªìÊûú„ÄÇ"
                                data-i18n="templateLocalization">Êú¨Âú∞Âåñ</span>
                            <span class="prompt-tag" data-template-type="ui"
                                data-prompt="‰Ω†ÊòØ‰∏Ä‰∏™UI/UXÊñáÊ°à‰∏ìÂÆ∂„ÄÇËØ∑Â∞Ü‰ª•‰∏ãÁïåÈù¢ÊñáÊú¨ÁøªËØëÊàê{targetLanguage}ÔºåË¶ÅÊ±ÇÁÆÄÊ¥ÅÊòé‰∫ÜÔºåÁ¨¶ÂêàÁî®Êà∑ÁïåÈù¢ÁöÑË°®ËææËßÑËåÉ„ÄÇÂè™ËøîÂõûÁøªËØëÁªìÊûú„ÄÇ"
                                data-i18n="templateUI">ÁïåÈù¢</span>
                            <span class="prompt-tag" data-template-type="technical"
                                data-prompt="‰Ω†ÊòØ‰∏Ä‰∏™ÊäÄÊúØÊñáÊ°£ÁøªËØë‰∏ìÂÆ∂„ÄÇËØ∑Â∞Ü‰ª•‰∏ãÊäÄÊúØÊñáÊú¨ÁøªËØëÊàê{targetLanguage}Ôºå‰øùÊåÅ‰∏ì‰∏öÊúØËØ≠ÁöÑÂáÜÁ°ÆÊÄß„ÄÇÂè™ËøîÂõûÁøªËØëÁªìÊûú„ÄÇ"
                                data-i18n="templateTechnical">ÊäÄÊúØ</span>
                            <!-- Ëá™ÂÆö‰πâÊ®°ÊùøÂ∞ÜÂä®ÊÄÅÊèíÂÖ•Âà∞ËøôÈáå -->
                        </div>
                        
                        <!-- ÂØºÂÖ•/ÂØºÂá∫ÊèêÁ§∫ËØçÊ®°Êùø -->
                        <div class="prompt-import-export">
                            <div class="import-export-buttons">
                                <button class="btn-import-export" id="importPromptsBtn" title="ÂØºÂÖ•ÊèêÁ§∫ËØçÊ®°Êùø">
                                    <span class="material-symbols-outlined icon-small">upload_file</span>
                                    <span>ÂØºÂÖ•</span>
                                </button>
                                <button class="btn-import-export" id="exportPromptsBtn" title="ÂØºÂá∫ÊèêÁ§∫ËØçÊ®°Êùø">
                                    <span class="material-symbols-outlined icon-small">download</span>
                                    <span>ÂØºÂá∫</span>
                                </button>
                            </div>
                            <div id="importResult" class="import-result"></div>
                            <input type="file" id="promptFileInput" accept=".json" style="display: none;">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ê®°ÊÄÅÊ°ÜÂ∫ïÈÉ®Âõ∫ÂÆö‰øùÂ≠òÊåâÈíÆ -->
            <div class="modal-footer">
                <button class="btn" id="saveConfig">
                    <span class="material-symbols-outlined icon-small">save</span>
                    <span data-i18n="save">‰øùÂ≠ò</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Êó•ÂøóÂõæÊ†áÊåâÈíÆ -->
    <div class="info-container">
        <select id="uiLanguage" onchange="changeLanguage(this.value)">
            <option value="zh-CN">üá®üá≥</option>
            <option value="en">üá∫üá∏</option>
            <option value="ja">üáØüáµ</option>
        </select>
        <a class="github-button" href="https://github.com/kimiisme/lumitrans" target="_blank" rel="noopener noreferrer" title="GitHub">
            <svg viewBox="0 0 16 16" aria-hidden="true" focusable="false">
                <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.19 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
            </svg>
        </a>
        <button class="log-button" id="logButton">
            <span class="material-symbols-outlined">info</span>
            <span class="badge" id="logBadge">0</span>
        </button>
    </div>

    <!-- Êó•ÂøóÂºπÁ™ó -->
    <div class="log-modal" id="logModal">
        <div class="log-header">
            <div class="log-title">
                <span class="material-symbols-outlined">history</span>
                <span>Êìç‰ΩúÊó•Âøó</span>
            </div>
            <button class="close-btn" id="closeLogModal">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        <div class="log-content" id="logContent">
            <!-- Êó•ÂøóÊù°ÁõÆÂ∞ÜÂä®ÊÄÅÊèíÂÖ•ËøôÈáå -->
        </div>
        <div class="log-actions">
            <button id="clearLogs">Ê∏ÖÁ©∫Êó•Âøó</button>
            <button id="exportLogs">ÂØºÂá∫Êó•Âøó</button>
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÁä∂ÊÄÅ
        let selectedCount = 0;
        let isTranslating = false;
        let config = {
            apiUrl: '',
            apiKey: '',
            modelName: 'gpt-4.1-nano',
            targetLanguage: 'zh-CN',
            customPrompt: '‰Ω†ÊòØ‰∏Ä‰∏™‰∏ì‰∏öÁöÑÁøªËØëÂä©Êâã„ÄÇËØ∑Â∞ÜÁî®Êà∑Êèê‰æõÁöÑÊñáÊú¨ÁøªËØëÊàê{targetLanguage}„ÄÇÂè™ËøîÂõûÁøªËØëÁªìÊûúÔºå‰∏çË¶ÅÊ∑ªÂä†‰ªª‰ΩïËß£ÈáäÊàñÂÖ∂‰ªñÂÜÖÂÆπ„ÄÇ',
            customPrompts: [],
            customModels: []
        };

        // DOM ÂÖÉÁ¥†
        const elements = {
            apiUrl: document.getElementById('apiUrl'),
            apiKey: document.getElementById('apiKey'),
            modelName: document.getElementById('modelName'),
            customPrompt: document.getElementById('customPrompt'),
            targetLanguage: document.getElementById('targetLanguage'),
            saveConfig: document.getElementById('saveConfig'),
            translateBtn: document.getElementById('translateBtn'),
            status: document.getElementById('status'),
            progress: document.getElementById('progress'),
            progressBar: document.getElementById('progressBar'),
            progressInfo: document.getElementById('progressInfo'),
            settingsToggle: document.getElementById('settingsToggle'),
            settingsModal: document.getElementById('settingsModal'),
            closeModal: document.getElementById('closeModal'),
            configStatus: document.getElementById('configStatus'),
            statusIndicator: document.getElementById('statusIndicator'),
            statusText: document.getElementById('statusText'),
            modelInfo: document.getElementById('modelInfo'),
            currentModel: document.getElementById('currentModel'),
            selectionCount: document.getElementById('selectionCount'),
            promptName: document.getElementById('promptName'),
            savePromptBtn: document.getElementById('savePromptBtn'),
            promptTemplates: document.querySelector('.prompt-templates'), // Ëé∑ÂèñÊèêÁ§∫ËØçÊ®°ÊùøÂÆπÂô®
            quickSaveModelBtn: document.getElementById('quickSaveModelBtn'),
            modelTemplates: document.querySelector('.model-templates'), // Ëé∑ÂèñÊ®°ÂûãÊ®°ÊùøÂÆπÂô®
            quickModelSelect: document.getElementById('quickModelSelect'), // Ëé∑ÂèñÊ®°ÂûãÂø´ÈÄüÂàáÊç¢‰∏ãÊãâÊ°Ü
            quickPromptSelect: document.getElementById('quickPromptSelect') // Ëé∑ÂèñÊèêÁ§∫ËØçÂø´ÈÄüÂàáÊç¢‰∏ãÊãâÊ°Ü
        };

        // ËØ≠Ë®ÄÂêçÁß∞Êò†Â∞Ñ
        const languageNames = {
            'zh-CN': 'ÁÆÄ‰Ωì‰∏≠Êñá',
            'zh-TW': 'ÁπÅ‰Ωì‰∏≠Êñá',
            'en': 'English',
            'ja': 'Êó•ËØ≠ üáØüáµ',
            'ko': 'Èü©ËØ≠ üá∞üá∑',
            'fr': 'Ê≥ïËØ≠ üá´üá∑',
            'de': 'Âæ∑ËØ≠ üá©üá™',
            'es': 'Ë•øÁè≠ÁâôËØ≠ üá™üá∏',
            'ru': '‰øÑËØ≠ üá∑üá∫',
            'ar': 'ÈòøÊãâ‰ºØËØ≠ üá∏üá¶',
            'pt': 'Ëë°ËêÑÁâôËØ≠ üáµüáπ',
            'it': 'ÊÑèÂ§ßÂà©ËØ≠ üáÆüáπ',
            'nl': 'Ëç∑ÂÖ∞ËØ≠ üá≥üá±',
            'sv': 'ÁëûÂÖ∏ËØ≠ üá∏üá™',
            'da': '‰∏πÈ∫¶ËØ≠ üá©üá∞',
            'no': 'Êå™Â®ÅËØ≠ üá≥üá¥',
            'fi': 'Ëä¨ÂÖ∞ËØ≠ üá´üáÆ',
            'pl': 'Ê≥¢ÂÖ∞ËØ≠ üáµüá±',
            'cs': 'Êç∑ÂÖãËØ≠ üá®üáø',
            'hu': 'ÂåàÁâôÂà©ËØ≠ üá≠üá∫',
            'tr': 'ÂúüËÄ≥ÂÖ∂ËØ≠ üáπüá∑',
            'th': 'Ê≥∞ËØ≠ üáπüá≠',
            'vi': 'Ë∂äÂçóËØ≠ üáªüá≥',
            'hi': 'Âç∞Âú∞ËØ≠ üáÆüá≥',
            'he': 'Â∏å‰ºØÊù•ËØ≠ üáÆüá±',
            'uk': '‰πåÂÖãÂÖ∞ËØ≠ üá∫üá¶'
        };

        // Êó•ÂøóÂäüËÉΩ
        const logSystem = {
            maxLogs: 100,
            logs: [],

            // Ê∑ªÂä†Êó•Âøó
            addLog(message, type = 'info') {
                const log = {
                    timestamp: new Date(),
                    message,
                    type
                };
                this.logs.unshift(log);
                if (this.logs.length > this.maxLogs) {
                    this.logs.pop();
                }
                this.updateUI();
                this.saveLogs();
            },

            // Êõ¥Êñ∞UI
            updateUI() {
                const logContent = document.getElementById('logContent');

                // Êõ¥Êñ∞Êó•ÂøóÂÜÖÂÆπ
                logContent.innerHTML = this.logs.map(log => `
                    <div class="log-entry ${log.type}">
                        <div class="timestamp">${log.timestamp.toLocaleString()}</div>
                        <div class="message">${log.message}</div>
                    </div>
                `).join('');
            },

            // Ê∏ÖÁ©∫Êó•Âøó
            clearLogs() {
                this.logs = [];
                this.unreadCount = 0;
                this.updateUI();
                this.saveLogs();
            },

            // ÂØºÂá∫Êó•Âøó
            exportLogs() {
                const logText = this.logs.map(log =>
                    `[${log.timestamp.toLocaleString()}] [${log.type}] ${log.message}`
                ).join('\n');

                const blob = new Blob([logText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `lumitrans-logs-${new Date().toISOString().slice(0, 10)}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            },

            // ‰øùÂ≠òÊó•ÂøóÂà∞localStorage
            saveLogs() {
                try {
                    localStorage.setItem('lumitrans-logs', JSON.stringify(this.logs));
                } catch (e) {
                    console.error('‰øùÂ≠òÊó•ÂøóÂ§±Ë¥•:', e);
                }
            },

            // Âä†ËΩΩÊó•Âøó
            loadLogs() {
                try {
                    const savedLogs = localStorage.getItem('lumitrans-logs');
                    if (savedLogs) {
                        this.logs = JSON.parse(savedLogs);
                        this.logs.forEach(log => {
                            log.timestamp = new Date(log.timestamp);
                        });
                        this.updateUI();
                    }
                } catch (e) {
                    console.error('Âä†ËΩΩÊó•ÂøóÂ§±Ë¥•:', e);
                }
            }
        };

        // ÂàùÂßãÂåñÊó•ÂøóÂäüËÉΩ
        document.addEventListener('DOMContentLoaded', () => {
            const logButton = document.getElementById('logButton');
            const logModal = document.getElementById('logModal');
            const closeLogModal = document.getElementById('closeLogModal');
            const clearLogs = document.getElementById('clearLogs');
            const exportLogs = document.getElementById('exportLogs');

            // Âä†ËΩΩ‰øùÂ≠òÁöÑÊó•Âøó
            logSystem.loadLogs();

            // ÁÇπÂáªÊó•ÂøóÊåâÈíÆ
            logButton.addEventListener('click', () => {
                logModal.classList.toggle('show');
            });

            // ÂÖ≥Èó≠Êó•ÂøóÂºπÁ™ó
            closeLogModal.addEventListener('click', () => {
                logModal.classList.remove('show');
            });

            // Ê∏ÖÁ©∫Êó•Âøó
            clearLogs.addEventListener('click', () => {
                if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÊó•ÂøóÂêóÔºü')) {
                    logSystem.clearLogs();
                }
            });

            // ÂØºÂá∫Êó•Âøó
            exportLogs.addEventListener('click', () => {
                logSystem.exportLogs();
            });

            // ÁÇπÂáªÂ§ñÈÉ®ÂÖ≥Èó≠Êó•ÂøóÂºπÁ™ó
            document.addEventListener('click', (e) => {
                if (!logModal.contains(e.target) && !logButton.contains(e.target)) {
                    logModal.classList.remove('show');
                }
            });
        });

        // ÊòæÁ§∫Áä∂ÊÄÅÊ∂àÊÅØ
        function showStatus(message, type = 'info') {
            elements.status.className = `status ${type}`;
            elements.status.textContent = message;
            elements.status.style.display = 'block';

            // Ê∑ªÂä†Âà∞Êó•Âøó
            logSystem.addLog(message, type);

            if (type === 'success') {
                setTimeout(() => {
                    elements.status.style.display = 'none';
                }, 3000);
            }
        }

        // Êõ¥Êñ∞ÈÖçÁΩÆÁä∂ÊÄÅÊòæÁ§∫
        function updateConfigStatus() {
            const isConfigured = config.apiUrl && config.apiKey;
            if (isConfigured) {
                elements.configStatus.className = 'config-status configured';
                elements.statusIndicator.className = 'status-indicator configured';
                elements.statusText.textContent = t('statusConfigured');
                elements.modelInfo.classList.remove('hidden');
                elements.currentModel.textContent = config.modelName;
            } else {
                elements.configStatus.className = 'config-status not-configured';
                elements.statusIndicator.className = 'status-indicator';
                elements.statusText.textContent = t('statusConfigNeeded');
                elements.modelInfo.classList.add('hidden');
            }
        }

        // Êõ¥Êñ∞ÈÄâ‰∏≠ËÆ°Êï∞ÊòæÁ§∫
        function updateSelectionDisplay() {
            elements.selectionCount.textContent = selectedCount;

            const hasConfig = config.apiUrl && config.apiKey && config.modelName;
            elements.translateBtn.disabled = !hasConfig || selectedCount === 0 || isTranslating;
        }

        // Êõ¥Êñ∞UIÁä∂ÊÄÅ
        function updateUI() {
            updateConfigStatus();
            updateSelectionDisplay();
        }

        // ÊòæÁ§∫ËÆæÁΩÆÂºπÁ™ó
        function showSettingsModal() {
            elements.settingsModal.classList.add('show');
            // ÂºπÁ™óÊòæÁ§∫ÂêéË∞ÉÊï¥È´òÂ∫¶
            setTimeout(() => {
                adjustUIHeight();
            }, 300); // Á≠âÂæÖÂä®ÁîªÂÆåÊàê
        }

        // ÈöêËóèËÆæÁΩÆÂºπÁ™ó
        function hideSettingsModal() {
            elements.settingsModal.classList.remove('show');
            // ÂºπÁ™óÈöêËóèÂêéË∞ÉÊï¥È´òÂ∫¶
            setTimeout(() => {
                adjustUIHeight();
            }, 300); // Á≠âÂæÖÂä®ÁîªÂÆåÊàê
        }

        // Âä†ËΩΩÈÖçÁΩÆ
        function loadConfig() {
            parent.postMessage({
                pluginMessage: { type: 'load-config' }
            }, '*');
        }

        // ‰øùÂ≠òÈÖçÁΩÆ
        function saveConfig() {
            config.apiUrl = elements.apiUrl.value.trim();
            config.apiKey = elements.apiKey.value.trim();
            config.modelName = elements.modelName.value.trim();
            config.customPrompt = elements.customPrompt.value.trim();

            parent.postMessage({
                pluginMessage: {
                    type: 'save-config',
                    config: config
                }
            }, '*');
        }

        // ‰øùÂ≠òËØ≠Ë®ÄËÆæÁΩÆ
        function saveLanguage() {
            const newLanguage = elements.targetLanguage.value;
            config.targetLanguage = newLanguage;

            parent.postMessage({
                pluginMessage: {
                    type: 'save-language',
                    language: newLanguage
                }
            }, '*');
        }

        // ÂºÄÂßãÁøªËØë
        function startTranslation() {
            if (selectedCount === 0) return;

            if (isTranslating) {
                // ÂÅúÊ≠¢ÁøªËØë
                parent.postMessage({
                    pluginMessage: { type: 'stop-translation' }
                }, '*');
                return;
            }

            isTranslating = true;
            elements.translateBtn.className = 'btn btn-stop';
            elements.translateBtn.innerHTML = '<span class="loading"><span class="stop-spinner"></span>ÂÅúÊ≠¢ÁøªËØë</span>';
            elements.progress.classList.remove('hidden');
            elements.progressInfo.classList.remove('hidden');
            elements.progressBar.style.width = '0%';

            parent.postMessage({
                pluginMessage: { type: 'translate' }
            }, '*');
        }

        // ÈáçÁΩÆÁøªËØëÊåâÈíÆ
        function resetTranslateButton() {
            isTranslating = false;
            elements.translateBtn.disabled = false;
            // ÊÅ¢Â§çÈªòËÆ§Ê†∑Âºè
            elements.translateBtn.className = 'btn btn-primary';
            elements.translateBtn.innerHTML = `
                <span class="material-symbols-outlined icon-small">rocket_launch</span>
                <span data-i18n="startTranslation">${t('startTranslation')}</span>
            `;
            elements.progress.classList.add('hidden');
            elements.progressInfo.classList.add('hidden');
        }

        // PromptÊ®°ÊùøÁÇπÂáª‰∫ã‰ª∂
        function setupPromptTemplates() {
            const promptTags = document.querySelectorAll('.prompt-tag');
            promptTags.forEach(tag => {
                tag.addEventListener('click', () => {
                    const prompt = tag.getAttribute('data-prompt');
                    elements.customPrompt.value = prompt;
                });
            });
        }

        // ‰øùÂ≠òËá™ÂÆö‰πâÊèêÁ§∫ËØç
        function saveCustomPrompt() {
            const promptName = elements.promptName.value.trim();
            const prompt = elements.customPrompt.value.trim();

            if (!promptName || !prompt) {
                showStatus(t('promptSavedFailed'), 'warning');
                return;
            }

            // ÂèëÈÄÅÊ∂àÊÅØÂà∞ÂêéÁ´Ø‰øùÂ≠ò
            parent.postMessage({
                pluginMessage: {
                    type: 'save-custom-prompt',
                    name: promptName,
                    content: prompt
                }
            }, '*');

            elements.promptName.value = ''; // Ê∏ÖÁ©∫ÂêçÁß∞ËæìÂÖ•Ê°Ü
        }

        // Ê∏≤ÊüìËá™ÂÆö‰πâÊèêÁ§∫ËØçÊ®°Êùø
        function renderCustomPrompts(customPrompts) {
            const promptTemplates = document.querySelector('.prompt-templates');
            // ÁßªÈô§ÊâÄÊúâËá™ÂÆö‰πâÊ®°Êùø
            const customTags = promptTemplates.querySelectorAll('.custom-prompt-tag');
            customTags.forEach(tag => tag.remove());

            // Ê∑ªÂä†Ëá™ÂÆö‰πâÊ®°Êùø
            if (customPrompts && customPrompts.length > 0) {
                customPrompts.forEach(prompt => {
                    const customTag = document.createElement('span');
                    customTag.className = 'prompt-tag custom-prompt-tag';
                    customTag.setAttribute('data-prompt', prompt.content);
                    customTag.innerHTML = `
                        ${prompt.name}
                        <span class="delete-prompt" data-id="${prompt.id}">
                            <span class="material-symbols-outlined icon-small">close</span>
                        </span>
                    `;

                    // ÁÇπÂáªÊ®°Êùø‰ΩøÁî®ÊèêÁ§∫ËØç
                    customTag.addEventListener('click', (e) => {
                        if (!e.target.closest('.delete-prompt')) {
                            elements.customPrompt.value = prompt.content;
                        }
                    });

                    // ÁÇπÂáªÂà†Èô§ÊåâÈíÆ
                    const deleteBtn = customTag.querySelector('.delete-prompt');
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        deleteCustomPrompt(prompt.id);
                    });

                    promptTemplates.appendChild(customTag);
                });
            }
        }

        // Âà†Èô§Ëá™ÂÆö‰πâÊèêÁ§∫ËØç
        function deleteCustomPrompt(promptId) {
            parent.postMessage({
                pluginMessage: {
                    type: 'delete-custom-prompt',
                    id: promptId
                }
            }, '*');
        }

        // ‰øùÂ≠òËá™ÂÆö‰πâÊ®°Âûã
        function saveCustomModel() {
            const modelName = elements.modelName.value.trim();

            if (!modelName) {
                showStatus(t('modelSavedFailed'), 'warning');
                return;
            }

            // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®Áõ∏ÂêåÁöÑÊ®°Âûã
            const existingModels = config.customModels || [];
            const isDuplicate = existingModels.some(model => model.modelName === modelName);

            if (isDuplicate) {
                showStatus(t('modelSavedDuplicate'), 'warning');
                return;
            }

            // ÂèëÈÄÅÊ∂àÊÅØÂà∞ÂêéÁ´Ø‰øùÂ≠ò
            parent.postMessage({
                pluginMessage: {
                    type: 'save-custom-model',
                    name: modelName, // Áõ¥Êé•‰ΩøÁî®Ê®°ÂûãÂêçÁß∞‰Ωú‰∏∫ÊòæÁ§∫ÂêçÁß∞
                    modelName: modelName
                }
            }, '*');
        }

        // Ê∏≤ÊüìËá™ÂÆö‰πâÊ®°ÂûãÊ®°Êùø
        function renderCustomModels(customModels) {
            const modelTemplates = document.querySelector('.model-templates');
            // ÁßªÈô§ÊâÄÊúâËá™ÂÆö‰πâÊ®°Âûã
            const customTags = modelTemplates.querySelectorAll('.custom-model-tag');
            customTags.forEach(tag => tag.remove());

            // Ê∑ªÂä†Ëá™ÂÆö‰πâÊ®°Âûã
            if (customModels && customModels.length > 0) {
                customModels.forEach(model => {
                    const customTag = document.createElement('span');
                    customTag.className = 'model-tag custom-model-tag';
                    customTag.setAttribute('data-model', model.modelName);
                    customTag.innerHTML = `
                        ${model.name}
                        <span class="delete-model" data-id="${model.id}">
                            <span class="material-symbols-outlined icon-small">close</span>
                        </span>
                    `;

                    // ÁÇπÂáªÊ®°Âûã‰ΩøÁî®Ê®°ÂûãÂêçÁß∞
                    customTag.addEventListener('click', (e) => {
                        if (!e.target.closest('.delete-model')) {
                            elements.modelName.value = model.modelName;
                        }
                    });

                    // ÁÇπÂáªÂà†Èô§ÊåâÈíÆ
                    const deleteBtn = customTag.querySelector('.delete-model');
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        deleteCustomModel(model.id);
                    });

                    modelTemplates.appendChild(customTag);
                });
            }
        }

        // Âà†Èô§Ëá™ÂÆö‰πâÊ®°Âûã
        function deleteCustomModel(modelId) {
            parent.postMessage({
                pluginMessage: {
                    type: 'delete-custom-model',
                    id: modelId
                }
            }, '*');
        }

        // Ê∏≤ÊüìÂø´ÈÄüÂàáÊç¢Ê®°Âûã‰∏ãÊãâÊ°Ü
        function renderQuickModelSelect() {
            const quickModelSelect = elements.quickModelSelect;

            // Ê∏ÖÁ©∫ÊâÄÊúâÈÄâÈ°π
            quickModelSelect.innerHTML = '';

            // Ê∑ªÂä†ÈªòËÆ§Ê®°ÂûãÈÄâÈ°π
            const defaultOption = document.createElement('option');
            defaultOption.value = 'gpt-4.1-nano';
            defaultOption.textContent = 'gpt-4.1-nano';
            quickModelSelect.appendChild(defaultOption);

            // Ê∑ªÂä†Ëá™ÂÆö‰πâÊ®°ÂûãÈÄâÈ°π
            if (config.customModels && config.customModels.length > 0) {
                config.customModels.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model.modelName;
                    option.textContent = model.name;
                    quickModelSelect.appendChild(option);
                });
            }

            // ËÆæÁΩÆÂΩìÂâçÈÄâ‰∏≠ÁöÑÊ®°Âûã
            quickModelSelect.value = config.modelName || 'gpt-4.1-nano';
        }

        // Ê∏≤ÊüìÂø´ÈÄüÂàáÊç¢ÊèêÁ§∫ËØç‰∏ãÊãâÊ°Ü
        function renderQuickPromptSelect() {
            const quickPromptSelect = elements.quickPromptSelect;

            // Ê∏ÖÁ©∫ÊâÄÊúâÈÄâÈ°π
            quickPromptSelect.innerHTML = '';

            // È¢ÑËÆæÊèêÁ§∫ËØçÊò†Â∞Ñ
            const defaultPrompts = {
                'standard': {
                    name: t('templateStandard'),
                    content: t('promptContentStandard')
                },
                'localization': {
                    name: t('templateLocalization'),
                    content: t('promptContentLocalization')
                },
                'ui': {
                    name: t('templateUI'),
                    content: t('promptContentUI')
                },
                'technical': {
                    name: t('templateTechnical'),
                    content: t('promptContentTechnical')
                }
            };

            // Ê∑ªÂä†ÈªòËÆ§ÊèêÁ§∫ËØçÈÄâÈ°π
            Object.keys(defaultPrompts).forEach(key => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = defaultPrompts[key].name;
                option.setAttribute('data-prompt', defaultPrompts[key].content);
                quickPromptSelect.appendChild(option);
            });

            // Ê∑ªÂä†Ëá™ÂÆö‰πâÊèêÁ§∫ËØçÈÄâÈ°π
            if (config.customPrompts && config.customPrompts.length > 0) {
                config.customPrompts.forEach(prompt => {
                    const option = document.createElement('option');
                    option.value = `custom_${prompt.id}`;
                    option.textContent = `${prompt.name} *`;
                    option.setAttribute('data-prompt', prompt.content);
                    quickPromptSelect.appendChild(option);
                });
            }

            // ËÆæÁΩÆÂΩìÂâçÈÄâ‰∏≠ÁöÑÊèêÁ§∫ËØç
            const currentPrompt = config.customPrompt;
            let selectedValue = 'standard'; // ÈªòËÆ§ÈÄâÊã©Ê†áÂáÜÁøªËØë

            // Ê£ÄÊü•ÊòØÂê¶ÂåπÈÖçÈ¢ÑËÆæÊèêÁ§∫ËØç
            for (const [key, prompt] of Object.entries(defaultPrompts)) {
                if (prompt.content === currentPrompt) {
                    selectedValue = key;
                    break;
                }
            }

            // Ê£ÄÊü•ÊòØÂê¶ÂåπÈÖçËá™ÂÆö‰πâÊèêÁ§∫ËØç
            if (config.customPrompts) {
                const matchedCustom = config.customPrompts.find(p => p.content === currentPrompt);
                if (matchedCustom) {
                    selectedValue = `custom_${matchedCustom.id}`;
                }
            }

            quickPromptSelect.value = selectedValue;
        }

        // ÂàáÊç¢Ê®°Âûã
        function switchModel(modelName) {
            config.modelName = modelName;
            elements.modelName.value = modelName;

            // Êõ¥Êñ∞ÊòæÁ§∫
            elements.currentModel.textContent = modelName;

            // ÈÄöÁü•‰∏ªÁ∫øÁ®ãÊõ¥Êñ∞ÈÖçÁΩÆ
            parent.postMessage({
                pluginMessage: {
                    type: 'update-config',
                    config: config
                }
            }, '*');

            updateUI();
            showStatus(t('modelSwitched', { modelName: modelName }), 'success');
        }

        // ÂàáÊç¢ÊèêÁ§∫ËØç
        function switchPrompt(promptValue, isCustom = false) {
            if (isCustom) {
                config.customPrompt = promptValue;
                elements.customPrompt.value = promptValue;
            } else {
                // Ëé∑ÂèñÈªòËÆ§ÊèêÁ§∫ËØçÊò†Â∞Ñ
                const defaultPrompts = {
                    'standard': {
                        name: t('templateStandard'),
                        content: t('promptContentStandard')
                    },
                    'localization': {
                        name: t('templateLocalization'),
                        content: t('promptContentLocalization')
                    },
                    'ui': {
                        name: t('templateUI'),
                        content: t('promptContentUI')
                    },
                    'technical': {
                        name: t('templateTechnical'),
                        content: t('promptContentTechnical')
                    }
                };

                if (defaultPrompts[promptValue]) {
                    config.customPrompt = defaultPrompts[promptValue].content;
                    elements.customPrompt.value = config.customPrompt;
                }
            }

            // ÈÄöÁü•‰∏ªÁ∫øÁ®ãÊõ¥Êñ∞ÈÖçÁΩÆ
            parent.postMessage({
                pluginMessage: {
                    type: 'update-config',
                    config: config
                }
            }, '*');

            showStatus(t('promptSwitched'), 'success');
        }

        // ÂàùÂßãÂåñÂø´ÈÄüÂàáÊç¢‰∏ãÊãâÊ°ÜÁöÑ‰∫ã‰ª∂ÁõëÂê¨
        function initQuickSwitchEvents() {
            // Ê®°Âûã‰∏ãÊãâÊ°ÜÂèòÂåñ‰∫ã‰ª∂
            elements.quickModelSelect.addEventListener('change', (e) => {
                switchModel(e.target.value);
            });

            // ÊèêÁ§∫ËØç‰∏ãÊãâÊ°ÜÂèòÂåñ‰∫ã‰ª∂
            elements.quickPromptSelect.addEventListener('change', (e) => {
                switchPrompt(e.target.value);
            });
        }

        // ‰∫ã‰ª∂ÁõëÂê¨
        elements.saveConfig.addEventListener('click', saveConfig);
        elements.translateBtn.addEventListener('click', startTranslation);
        elements.settingsToggle.addEventListener('click', showSettingsModal);
        elements.closeModal.addEventListener('click', hideSettingsModal);
        elements.targetLanguage.addEventListener('change', saveLanguage);
        elements.savePromptBtn.addEventListener('click', saveCustomPrompt);
        elements.quickSaveModelBtn.addEventListener('click', saveCustomModel); // Ê∑ªÂä†Âø´ÈÄü‰øùÂ≠òÊåâÈíÆ‰∫ã‰ª∂

        // ÂØºÂÖ•/ÂØºÂá∫‰∫ã‰ª∂ÁõëÂê¨
        document.getElementById('importPromptsBtn').addEventListener('click', importPrompts);
        document.getElementById('exportPromptsBtn').addEventListener('click', exportPrompts);
        document.getElementById('promptFileInput').addEventListener('change', handlePromptFileImport);

        // APIÊµãËØïÊåâÈíÆ‰∫ã‰ª∂ÁõëÂê¨
        document.getElementById('testApiBtn').addEventListener('click', () => {
            testApiConnectivity('manual');
        });

        // ‰∏∫Ê®°ÂûãËæìÂÖ•Ê°ÜÊ∑ªÂä†ÂõûËΩ¶ÈîÆÂø´ÈÄü‰øùÂ≠ò
        elements.modelName.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                saveCustomModel();
            }
        });

        // ÁÇπÂáªÈÅÆÁΩ©ÂÖ≥Èó≠ÂºπÁ™ó
        elements.settingsModal.addEventListener('click', (e) => {
            if (e.target === elements.settingsModal) {
                hideSettingsModal();
            }
        });

        // ESCÈîÆÂÖ≥Èó≠ÂºπÁ™ó
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && elements.settingsModal.classList.contains('show')) {
                hideSettingsModal();
            }
        });

        // Ê∂àÊÅØÂ§ÑÁêÜ
        window.onmessage = (event) => {
            const msg = event.data.pluginMessage;

            switch (msg.type) {
                case 'log':
                    // Â§ÑÁêÜÊó•ÂøóÊ∂àÊÅØ
                    logSystem.addLog(msg.message, msg.logType);
                    break;

                case 'config-loaded':
                    console.log('Êî∂Âà∞config-loadedÊ∂àÊÅØ:', msg.config);
                    config = { ...config, ...msg.config };
                    console.log('ÂêàÂπ∂ÂêéÁöÑÈÖçÁΩÆ:', config);

                    // Â°´ÂÖÖË°®ÂçïÂ≠óÊÆµ
                    if (elements.apiUrl) elements.apiUrl.value = config.apiUrl || '';
                    if (elements.apiKey) elements.apiKey.value = config.apiKey || '';
                    if (elements.modelName) elements.modelName.value = config.modelName || 'gpt-4.1-nano';
                    if (elements.customPrompt) elements.customPrompt.value = config.customPrompt || '';
                    if (elements.targetLanguage) elements.targetLanguage.value = config.targetLanguage || 'zh-CN';

                    updateUI();
                    // Ê∏≤ÊüìËá™ÂÆö‰πâÊ®°ÂûãÂíåÊèêÁ§∫ËØç
                    if (config.customModels) {
                        console.log('ÂºÄÂßãÊ∏≤ÊüìËá™ÂÆö‰πâÊ®°Âûã:', config.customModels);
                        renderCustomModels(config.customModels);
                    }
                    if (config.customPrompts) {
                        console.log('ÂºÄÂßãÊ∏≤ÊüìËá™ÂÆö‰πâÊèêÁ§∫ËØç:', config.customPrompts);
                        renderCustomPrompts(config.customPrompts);
                    }
                    // Êõ¥Êñ∞Âø´ÈÄüÂàáÊç¢Âå∫Âüü
                    renderQuickModelSelect();
                    renderQuickPromptSelect();
                    // Ëß¶ÂèëAPIËøûÈÄöÊÄßÊµãËØïÂπ∂ÂêØÂä®ÂÆöÊó∂Âô®
                    testApiConnectivity('init');
                    scheduleApiHealthChecks();
                    break;

                case 'config-saved':
                    showStatus(t('configSaved'), 'success');
                    updateUI();
                    // Êõ¥Êñ∞Âø´ÈÄüÂàáÊç¢Âå∫Âüü
                    renderQuickModelSelect();
                    renderQuickPromptSelect();
                    // ‰øùÂ≠òÊàêÂäüÂêéËá™Âä®ÂÖ≥Èó≠ËÆæÁΩÆÊ®°ÊÄÅÊ°Ü
                    hideSettingsModal();
                    // ‰øùÂ≠òËÆæÁΩÆÂêéÁ´ãÂç≥ËøõË°åËøûÈÄöÊÄßÊµãËØïÂπ∂ÈáçÁΩÆÂÆöÊó∂Âô®
                    testApiConnectivity('saved');
                    scheduleApiHealthChecks();
                    break;

                case 'language-saved':
                    showStatus(t('languageSwitched', { language: t('languages.' + msg.language) }), 'success');
                    break;

                case 'selection-changed':
                    selectedCount = msg.count;
                    elements.selectionCount.textContent = selectedCount;
                    elements.translateBtn.disabled = selectedCount === 0 || !config.apiUrl || !config.apiKey;
                    break;

                case 'translation-started':
                    isTranslating = true;
                    elements.translateBtn.disabled = false;
                    elements.translateBtn.innerHTML = `
                        <span class="material-symbols-outlined icon-small">stop</span>
                        <span data-i18n="stopTranslation">${t('stopTranslation')}</span>
                    `;
                    elements.progress.classList.remove('hidden');
                    elements.progressInfo.classList.remove('hidden');
                    showStatus(t('translationStarted'), 'info');
                    break;

                case 'translation-stopped':
                    showStatus(t('translationStopping'), 'warning');
                    elements.translateBtn.innerHTML = `<span class="loading"><span class="stop-spinner"></span>${t('statusStopping')}</span>`;
                    break;

                case 'translation-stopped-complete':
                    resetTranslateButton();
                    showStatus(t('translationStopped', { completed: msg.completed, total: msg.total }), 'warning');
                    break;

                case 'translation-progress':
                    elements.progressBar.style.width = `${msg.progress}%`;
                    let progressText;

                    if (msg.status === 'processing') {
                        progressText = t('progressProcessingDetail', {
                            completed: msg.completed,
                            total: msg.total,
                            currentText: msg.currentText
                        });
                    } else if (msg.currentText) {
                        progressText = t('progressTranslatingDetail', {
                            completed: msg.completed,
                            total: msg.total,
                            progress: msg.progress,
                            currentText: msg.currentText
                        });
                    } else {
                        progressText = t('progressTranslatingSimple', {
                            completed: msg.completed,
                            total: msg.total,
                            progress: msg.progress
                        });
                    }

                    elements.progressInfo.textContent = progressText;
                    break;

                case 'translation-completed':
                    resetTranslateButton();
                    const message = msg.hasError
                        ? t('translationCompletedPartial', { completed: msg.completed, total: msg.total })
                        : t('translationCompletedAll');
                    showStatus(message, msg.hasError ? 'warning' : 'success');
                    break;

                case 'error':
                    resetTranslateButton();
                    showStatus(msg.message, 'error');
                    // Â∞ÜÈîôËØØÂÜôÂÖ•Êó•Âøó
                    if (typeof logSystem !== 'undefined') {
                        logSystem.addLog(msg.message, 'error');
                    }
                    break;

                case 'custom-prompt-saved':
                    showStatus(t('promptSaved', { name: msg.name }), 'success');
                    renderCustomPrompts(msg.prompts);
                    // Êõ¥Êñ∞Êú¨Âú∞config‰∏≠ÁöÑËá™ÂÆö‰πâÊèêÁ§∫ËØçÊï∞ÊçÆ
                    config.customPrompts = msg.prompts;
                    // Êõ¥Êñ∞Âø´ÈÄüÂàáÊç¢ÊèêÁ§∫ËØç‰∏ãÊãâÊ°Ü
                    renderQuickPromptSelect();
                    break;

                case 'custom-prompt-deleted':
                    showStatus(t('promptDeleted', { name: msg.name }), 'success');
                    renderCustomPrompts(msg.prompts);
                    // Êõ¥Êñ∞Êú¨Âú∞config‰∏≠ÁöÑËá™ÂÆö‰πâÊèêÁ§∫ËØçÊï∞ÊçÆ
                    config.customPrompts = msg.prompts;
                    // Êõ¥Êñ∞Âø´ÈÄüÂàáÊç¢ÊèêÁ§∫ËØç‰∏ãÊãâÊ°Ü
                    renderQuickPromptSelect();
                    break;

                case 'custom-model-saved':
                    showStatus(t('modelSaved', { name: msg.name }), 'success');
                    renderCustomModels(msg.models);
                    // Êõ¥Êñ∞Êú¨Âú∞config‰∏≠ÁöÑËá™ÂÆö‰πâÊ®°ÂûãÊï∞ÊçÆ
                    config.customModels = msg.models;
                    // Êõ¥Êñ∞Âø´ÈÄüÂàáÊç¢Ê®°Âûã‰∏ãÊãâÊ°Ü
                    renderQuickModelSelect();
                    break;

                case 'custom-model-deleted':
                    showStatus(t('modelDeleted', { name: msg.name }), 'success');
                    renderCustomModels(msg.models);
                    // Êõ¥Êñ∞Êú¨Âú∞config‰∏≠ÁöÑËá™ÂÆö‰πâÊ®°ÂûãÊï∞ÊçÆ
                    config.customModels = msg.models;
                    // Êõ¥Êñ∞Âø´ÈÄüÂàáÊç¢Ê®°Âûã‰∏ãÊãâÊ°Ü
                    renderQuickModelSelect();
                    break;

                case 'prompts-imported':
                    showStatus(`ÊàêÂäüÂØºÂÖ• ${msg.count} ‰∏™ÊèêÁ§∫ËØçÊ®°Êùø`, 'success');
                    // Êõ¥Êñ∞Êú¨Âú∞config‰∏≠ÁöÑËá™ÂÆö‰πâÊèêÁ§∫ËØçÊï∞ÊçÆ
                    config.customPrompts = msg.prompts;
                    // ÈáçÊñ∞Ê∏≤ÊüìÁïåÈù¢
                    renderCustomPrompts(config.customPrompts);
                    renderQuickPromptSelect();
                    break;
            }
        };

        // ÂàùÂßãÂåñ
        updateUI();
        setupPromptTemplates();
        initQuickSwitchEvents();
        initLanguage(); // ÂàùÂßãÂåñËØ≠Ë®ÄËÆæÁΩÆ

        // Ê∑ªÂä†Ë∞ÉËØïÂäüËÉΩÂà∞ÂÖ®Â±Ä‰ΩúÁî®Âüü
        window.debugLumitrans = function () {
            console.log('=== lumitrans Ë∞ÉËØï‰ø°ÊÅØ ===');
            console.log('ÂΩìÂâçÈÖçÁΩÆ:', config);
            console.log('Ëá™ÂÆö‰πâÊ®°Âûã:', config.customModels);
            console.log('Ëá™ÂÆö‰πâÊèêÁ§∫ËØç:', config.customPrompts);

            // Â∞ùËØïÁõ¥Êé•‰ªélocalStorageËØªÂèñÊï∞ÊçÆ
            try {
                const storedData = localStorage.getItem('lumi-config');
                console.log('localStorage‰∏≠ÁöÑÂéüÂßãÊï∞ÊçÆ:', storedData);
                if (storedData) {
                    const parsedData = JSON.parse(storedData);
                    console.log('Ëß£ÊûêÂêéÁöÑÊï∞ÊçÆ:', parsedData);
                }
            } catch (e) {
                console.error('ËØªÂèñlocalStorageÂ§±Ë¥•:', e);
            }
        };

        loadConfig(); // Âä†ËΩΩÈÖçÁΩÆ

        // Âª∂ËøüÊ∏≤ÊüìÁ°Æ‰øùÈÖçÁΩÆÂ∑≤Âä†ËΩΩ
        setTimeout(() => {
            console.log('Âª∂ËøüÊ∏≤ÊüìÊâßË°å‰∏≠...');
            console.log('ÂΩìÂâçconfig:', config);

            if (config.customModels && config.customModels.length > 0) {
                console.log('Ê∏≤ÊüìËá™ÂÆö‰πâÊ®°Âûã:', config.customModels);
                renderCustomModels(config.customModels);
            }
            if (config.customPrompts && config.customPrompts.length > 0) {
                console.log('Ê∏≤ÊüìËá™ÂÆö‰πâÊèêÁ§∫ËØç:', config.customPrompts);
                renderCustomPrompts(config.customPrompts);
            }
            renderQuickModelSelect();
            renderQuickPromptSelect();
        }, 500);

        // API ËøûÈÄöÊÄßÊµãËØï
        let apiHealthTimerId = null;
        async function testApiConnectivity(reason = 'manual') {
            const testBtn = document.getElementById('testApiBtn');
            const testResult = document.getElementById('apiTestResult');
            
            try {
                // Â¶ÇÊûúÊú™ÈÖçÁΩÆÔºåÊòæÁ§∫Êú™ÈÖçÁΩÆÁä∂ÊÄÅ
                const hasConfig = config.apiUrl && config.apiKey && config.modelName;
                if (!hasConfig) {
                    if (reason === 'manual') {
                        showApiTestResult('ËØ∑ÂÖàÈÖçÁΩÆAPIÂú∞ÂùÄ„ÄÅÂØÜÈí•ÂíåÊ®°ÂûãÂêçÁß∞', 'error');
                    }
                    setApiStatus('not-configured', t('statusConfigNeeded'));
                    return;
                }
                
                // ËÆæÁΩÆÊåâÈíÆ‰∏∫ÊµãËØï‰∏≠Áä∂ÊÄÅ
                if (reason === 'manual') {
                    testBtn.disabled = true;
                    testBtn.classList.add('testing');
                    testBtn.innerHTML = '<span class="material-symbols-outlined icon-small">wifi_tethering</span><span>ÊµãËØï‰∏≠...</span>';
                    showApiTestResult('Ê≠£Âú®ÊµãËØïAPIËøûÈÄöÊÄß...', 'info');
                }
                
                // ËÆæÁΩÆ‰∏∫ÊµãËØï‰∏≠
                setApiStatus('testing', t('statusApiTestingShort'));
                
                // 7ÁßíË∂ÖÊó∂ÊéßÂà∂
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 7000);
                
                // ‰ΩøÁî®Êõ¥ÂÖºÂÆπÁöÑÊµãËØïËØ∑Ê±ÇÊ†ºÂºè
                const testRequest = {
                    model: config.modelName,
                    messages: [
                        { role: 'user', content: 'Hello' }
                    ],
                    max_tokens: 5,
                    temperature: 0
                };
                
                // Ê†πÊçÆAPIÁ±ªÂûãÂíåÊ®°ÂûãÂêçÁß∞Ë∞ÉÊï¥ËØ∑Ê±ÇÊ†ºÂºè
                if (config.apiUrl.includes('openai.com') || config.apiUrl.includes('api.openai.com') || 
                    config.modelName.includes('gpt') || config.modelName.includes('openai')) {
                    // OpenAIÊ†ºÂºè
                    testRequest.messages = [
                        { role: 'user', content: 'Hi' }
                    ];
                } else if (config.apiUrl.includes('claude') || config.apiUrl.includes('anthropic') || 
                           config.modelName.includes('claude')) {
                    // ClaudeÊ†ºÂºè
                    testRequest.messages = [
                        { role: 'user', content: 'Hi' }
                    ];
                } else if (config.apiUrl.includes('qwen') || config.apiUrl.includes('dashscope') || 
                           config.modelName.includes('qwen')) {
                    // ÈÄö‰πâÂçÉÈóÆÊ†ºÂºè
                    testRequest.messages = [
                        { role: 'user', content: 'Hi' }
                    ];
                } else {
                    // ÈÄöÁî®Ê†ºÂºèÔºåÂ∞ùËØïÊúÄÂ∞èÂåñËØ∑Ê±Ç
                    testRequest.max_tokens = 1;
                    testRequest.messages = [
                        { role: 'user', content: 'Hi' }
                    ];
                }
                
                const resp = await fetch(config.apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${config.apiKey}`
                    },
                    body: JSON.stringify(testRequest),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (resp.ok) {
                    setApiStatus('configured', t('statusApiOkShort'));
                    if (reason === 'manual') {
                        showApiTestResult('APIËøûÈÄöÊÄßÊµãËØïÊàêÂäüÔºÅ', 'success');
                    }
                    logSystem && logSystem.addLog(`APIËøûÈÄöÊÄßÊ≠£Â∏∏ÔºàÂéüÂõ†: ${reason}Ôºâ`, 'success');
                } else {
                    // Âç≥‰ΩøËøîÂõûÈîôËØØÁä∂ÊÄÅÁ†ÅÔºå‰πüÊ£ÄÊü•ÂìçÂ∫îÂÜÖÂÆπ
                    try {
                        const errorData = await resp.json();
                        const errorMsg = errorData.error?.message || errorData.message || `${resp.status} ${resp.statusText}`;
                        setApiStatus('error', `${t('statusApiErrorShort')}: ${errorMsg}`);
                        if (reason === 'manual') {
                            showApiTestResult(`APIËøûÈÄöÊÄßÊµãËØïÂ§±Ë¥•: ${errorMsg}`, 'error');
                        }
                        logSystem && logSystem.addLog(`APIËøûÈÄöÊÄßÂ§±Ë¥•ÔºàÂéüÂõ†: ${reason}ÔºâÔºö${errorMsg}`, 'error');
                    } catch (parseError) {
                        // Â¶ÇÊûúÊó†Ê≥ïËß£ÊûêÈîôËØØ‰ø°ÊÅØÔºå‰ΩøÁî®Áä∂ÊÄÅÁ†Å
                        const errorMsg = `${resp.status} ${resp.statusText}`;
                        setApiStatus('error', `${t('statusApiErrorShort')}: ${errorMsg}`);
                        if (reason === 'manual') {
                            showApiTestResult(`APIËøûÈÄöÊÄßÊµãËØïÂ§±Ë¥•: ${errorMsg}`, 'error');
                        }
                        logSystem && logSystem.addLog(`APIËøûÈÄöÊÄßÂ§±Ë¥•ÔºàÂéüÂõ†: ${reason}ÔºâÔºö${errorMsg}`, 'error');
                    }
                }
            } catch (e) {
                let message = '';
                if (e.name === 'AbortError') {
                    message = 'APIËøûÈÄöË∂ÖÊó∂';
                } else if (e.message.includes('Failed to fetch') || e.message.includes('NetworkError')) {
                    message = 'ÁΩëÁªúËøûÊé•Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËÆæÁΩÆ';
                } else if (e.message.includes('CORS')) {
                    message = 'CORSÈîôËØØÔºåËØ∑Ê£ÄÊü•APIÈÖçÁΩÆ';
                } else {
                    message = `APIËøûÈÄöÂºÇÂ∏∏: ${e.message}`;
                }
                
                setApiStatus('error', message);
                if (reason === 'manual') {
                    showApiTestResult(`APIËøûÈÄöÊÄßÊµãËØïÂ§±Ë¥•: ${message}`, 'error');
                }
                logSystem && logSystem.addLog(`${message}`, 'error');
            } finally {
                // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                if (reason === 'manual') {
                    testBtn.disabled = false;
                    testBtn.classList.remove('testing');
                    testBtn.innerHTML = '<span class="material-symbols-outlined icon-small">wifi_tethering</span><span>ÊµãËØïËøûÊé•</span>';
                }
            }
        }

        // ÊòæÁ§∫APIÊµãËØïÁªìÊûú
        function showApiTestResult(message, type = 'info') {
            const resultElement = document.getElementById('apiTestResult');
            if (resultElement) {
                resultElement.textContent = message;
                resultElement.className = `api-test-result ${type}`;
                resultElement.style.display = 'block';
                
                // 5ÁßíÂêéËá™Âä®ÈöêËóè
                setTimeout(() => {
                    resultElement.style.display = 'none';
                }, 5000);
            }
        }

        function setApiStatus(status, detailText) {
            const container = elements.configStatus;
            const indicator = elements.statusIndicator;
            const label = elements.statusText;
            // ÈáçÁΩÆÁ±ªÂêç
            container.className = 'config-status';
            indicator.className = 'status-indicator';
            if (status === 'configured') {
                container.classList.add('configured');
                indicator.classList.add('configured');
            } else if (status === 'testing') {
                container.classList.add('testing');
                indicator.classList.add('testing');
            } else if (status === 'error') {
                container.classList.add('error');
                indicator.classList.add('error');
            } else {
                container.classList.add('not-configured');
            }
            // ‰ΩøÁî®Â§öËØ≠Ë®ÄÁÆÄÁü≠ÊñáÊ°à
            const shortTextMap = {
                'configured': 'statusApiOkShort',
                'testing': 'statusApiTestingShort',
                'error': 'statusApiErrorShort',
                'not-configured': 'statusApiNotConfiguredShort'
            };
            const i18nKey = shortTextMap[status] || 'statusApiNotConfiguredShort';
            label.textContent = t(i18nKey);
            // ËØ¶ÁªÜ‰ø°ÊÅØÊîæÂú®titleÔºåÈº†Ê†áÊÇ¨ÂÅúÂèØËßÅ
            if (detailText) {
                label.title = detailText;
                container.title = detailText;
            } else {
                label.removeAttribute('title');
                container.removeAttribute('title');
            }
        }
        function scheduleApiHealthChecks() {
            if (apiHealthTimerId) clearInterval(apiHealthTimerId);
            const hasConfig = config.apiUrl && config.apiKey && config.modelName;
            if (!hasConfig) return;
            apiHealthTimerId = setInterval(() => testApiConnectivity('periodic'), 60000);
        }

        // ÂØºÂÖ•ÊèêÁ§∫ËØçÊ®°Êùø
        function importPrompts() {
            const fileInput = document.getElementById('promptFileInput');
            fileInput.click();
        }

        // Â§ÑÁêÜÊñá‰ª∂ÂØºÂÖ•
        function handlePromptFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = JSON.parse(e.target.result);
                    processImportedPrompts(content);
                } catch (error) {
                    showImportResult('JSONÊñá‰ª∂Ê†ºÂºèÈîôËØØÔºåËØ∑Ê£ÄÊü•Êñá‰ª∂ÂÜÖÂÆπ', 'error');
                }
            };
            reader.readAsText(file);
            
            // Ê∏ÖÁ©∫Êñá‰ª∂ËæìÂÖ•ÔºåÂÖÅËÆ∏ÈáçÂ§çÈÄâÊã©Âêå‰∏ÄÊñá‰ª∂
            event.target.value = '';
        }

        // Â§ÑÁêÜÂØºÂÖ•ÁöÑÊèêÁ§∫ËØçÊï∞ÊçÆ
        function processImportedPrompts(importedData) {
            try {
                // È™åËØÅÊï∞ÊçÆÁªìÊûÑ
                if (!Array.isArray(importedData)) {
                    showImportResult('ÂØºÂÖ•Êñá‰ª∂Ê†ºÂºèÈîôËØØÔºöÂ∫î‰∏∫Êï∞ÁªÑÊ†ºÂºè', 'error');
                    return;
                }

                let validPrompts = [];
                let skippedCount = 0;
                let errorCount = 0;

                importedData.forEach((item, index) => {
                    // È™åËØÅÂøÖË¶ÅÂ≠óÊÆµ
                    if (!item.name || !item.content) {
                        skippedCount++;
                        return;
                    }

                    // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®Áõ∏ÂêåÂêçÁß∞ÁöÑÊèêÁ§∫ËØç
                    const existingPrompt = config.customPrompts.find(p => p.name === item.name);
                    if (existingPrompt) {
                        // Â¶ÇÊûúÂ∑≤Â≠òÂú®ÔºåÂèØ‰ª•ÈÄâÊã©Ë∑≥ËøáÊàñË¶ÜÁõñ
                        skippedCount++;
                        return;
                    }

                    // ÂàõÂª∫Êñ∞ÁöÑÊèêÁ§∫ËØçÂØπË±°
                    const newPrompt = {
                        id: Date.now().toString() + '_' + index, // ÁîüÊàêÂîØ‰∏ÄID
                        name: item.name.trim(),
                        content: item.content.trim()
                    };

                    validPrompts.push(newPrompt);
                });

                if (validPrompts.length === 0) {
                    showImportResult('Ê≤°ÊúâÊâæÂà∞ÊúâÊïàÁöÑÊèêÁ§∫ËØçÊ®°Êùø', 'warning');
                    return;
                }

                // ÂêàÂπ∂Âà∞Áé∞ÊúâÈÖçÁΩÆ‰∏≠
                config.customPrompts = [...(config.customPrompts || []), ...validPrompts];

                // ÂèëÈÄÅÂà∞ÂêéÁ´Ø‰øùÂ≠ò
                parent.postMessage({
                    pluginMessage: {
                        type: 'import-prompts',
                        prompts: validPrompts
                    }
                }, '*');

                // ÊòæÁ§∫ÂØºÂÖ•ÁªìÊûú
                const message = `ÊàêÂäüÂØºÂÖ• ${validPrompts.length} ‰∏™ÊèêÁ§∫ËØçÊ®°Êùø`;
                const details = [];
                if (skippedCount > 0) details.push(`Ë∑≥Ëøá ${skippedCount} ‰∏™ÈáçÂ§çÈ°π`);
                if (errorCount > 0) details.push(`ÈîôËØØ ${errorCount} ‰∏™Êó†ÊïàÈ°π`);
                
                if (details.length > 0) {
                    showImportResult(`${message}Ôºà${details.join('Ôºå')}Ôºâ`, 'success');
                } else {
                    showImportResult(message, 'success');
                }

                // ÈáçÊñ∞Ê∏≤ÊüìÁïåÈù¢
                renderCustomPrompts(config.customPrompts);
                renderQuickPromptSelect();

            } catch (error) {
                showImportResult(`Â§ÑÁêÜÂØºÂÖ•Êï∞ÊçÆÊó∂Âá∫Èîô: ${error.message}`, 'error');
            }
        }

        // ÂØºÂá∫ÊèêÁ§∫ËØçÊ®°Êùø
        function exportPrompts() {
            try {
                const exportData = config.customPrompts || [];
                
                if (exportData.length === 0) {
                    showImportResult('Ê≤°ÊúâÂèØÂØºÂá∫ÁöÑÊèêÁ§∫ËØçÊ®°Êùø', 'info');
                    return;
                }

                // ÂáÜÂ§áÂØºÂá∫Êï∞ÊçÆÔºà‰∏çÂåÖÂê´ÂÜÖÈÉ®IDÔºâ
                const exportPrompts = exportData.map(prompt => ({
                    name: prompt.name,
                    content: prompt.content
                }));

                // ÂàõÂª∫Âπ∂‰∏ãËΩΩÊñá‰ª∂
                const blob = new Blob([JSON.stringify(exportPrompts, null, 2)], { 
                    type: 'application/json' 
                });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `lumitrans-prompts-${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showImportResult(`ÊàêÂäüÂØºÂá∫ ${exportData.length} ‰∏™ÊèêÁ§∫ËØçÊ®°Êùø`, 'success');

            } catch (error) {
                showImportResult(`ÂØºÂá∫Â§±Ë¥•: ${error.message}`, 'error');
            }
        }

        // ÊòæÁ§∫ÂØºÂÖ•ÁªìÊûú
        function showImportResult(message, type = 'info') {
            const resultElement = document.getElementById('importResult');
            resultElement.textContent = message;
            resultElement.className = `import-result ${type}`;
            resultElement.style.display = 'block';

            // 3ÁßíÂêéËá™Âä®ÈöêËóè
            setTimeout(() => {
                resultElement.style.display = 'none';
            }, 3000);
        }
    </script>
</body>

</html>