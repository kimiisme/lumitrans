<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>LUMIå¤šè¯­è¨€AIç¿»è¯‘åŠ©æ‰‹</title>
    <!-- Google Material Symbols -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet">
    
    <!-- å¤šè¯­è¨€æ•°æ® -->
    <script>
        // è¯­è¨€æ–‡ä»¶
        const i18nData = {
            'zh-CN': {
                // ä¸»ç•Œé¢
                title: 'LUMIç¿»è¯‘åŠ©æ‰‹',
                settings: 'è®¾ç½®',
                selectedText: 'ä¸ªæ–‡æœ¬å›¾å±‚å·²é€‰ä¸­',
                targetLanguage: 'ç¿»è¯‘ç›®æ ‡è¯­è¨€',
                model: 'æ¨¡å‹',
                promptTemplate: 'æç¤ºè¯æ¨¡æ¿',
                startTranslation: 'å¼€å§‹ç¿»è¯‘',
                stopTranslation: 'åœæ­¢ç¿»è¯‘',
                
                // è®¾ç½®å¯¹è¯æ¡†
                apiUrl: 'APIåœ°å€',
                apiKey: 'APIå¯†é’¥',
                prompt: 'æç¤ºè¯',
                save: 'ä¿å­˜',
                close: 'å…³é—­',
                
                // è¯­è¨€é€‰æ‹©
                language: 'ç•Œé¢è¯­è¨€',
                
                // å ä½ç¬¦æ–‡æœ¬
                placeholderApiUrl: 'https://api.openai.com/v1/chat/completions',
                placeholderApiKey: 'sk-...',
                placeholderModel: 'gpt-4.1-nano',
                placeholderPrompt: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç¿»è¯‘åŠ©æ‰‹...',
                placeholderPromptName: 'ä¸ºæ­¤æç¤ºè¯å‘½å...',
                
                // çŠ¶æ€æ¶ˆæ¯
                statusConfigNeeded: 'è¯·å…ˆé…ç½®APIè®¾ç½®',
                statusConfigured: 'é…ç½®å·²å®Œæˆ',
                statusTranslating: 'ç¿»è¯‘ä¸­...',
                statusCompleted: 'ç¿»è¯‘å®Œæˆï¼',
                statusStopping: 'æ­£åœ¨åœæ­¢ç¿»è¯‘...',
                statusError: 'ç¿»è¯‘å‡ºé”™',
                
                // è¿›åº¦æ¶ˆæ¯
                progressProcessing: 'æ­£åœ¨å¤„ç†',
                progressTranslating: 'ç¿»è¯‘è¿›åº¦',
                
                // æç¤ºè¯æ¨¡æ¿
                templateStandard: 'æ ‡å‡†ç¿»è¯‘',
                templateLocalization: 'æœ¬åœ°åŒ–',
                templateUI: 'ç•Œé¢æ–‡æ¡ˆ',
                templateTechnical: 'æŠ€æœ¯æ–‡æ¡£',
                
                // æç¤ºè¯æ¨¡æ¿å†…å®¹
                promptContentStandard: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç¿»è¯‘åŠ©æ‰‹ã€‚è¯·å°†ç”¨æˆ·æä¾›çš„æ–‡æœ¬ç¿»è¯‘æˆ{targetLanguage}ã€‚åªè¿”å›ç¿»è¯‘ç»“æœï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæˆ–å…¶ä»–å†…å®¹ã€‚',
                promptContentLocalization: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æœ¬åœ°åŒ–ä¸“å®¶ã€‚è¯·å°†ä»¥ä¸‹æ–‡æœ¬ç¿»è¯‘æˆ{targetLanguage}ï¼Œä¿æŒåŸæ–‡çš„è¯­æ°”å’Œé£æ ¼ï¼Œä½¿å…¶ç¬¦åˆç›®æ ‡è¯­è¨€çš„è¡¨è¾¾ä¹ æƒ¯ã€‚åªè¿”å›ç¿»è¯‘ç»“æœã€‚',
                promptContentUI: 'ä½ æ˜¯ä¸€ä¸ªUI/UXæ–‡æ¡ˆä¸“å®¶ã€‚è¯·å°†ä»¥ä¸‹ç•Œé¢æ–‡æœ¬ç¿»è¯‘æˆ{targetLanguage}ï¼Œè¦æ±‚ç®€æ´æ˜äº†ï¼Œç¬¦åˆç”¨æˆ·ç•Œé¢çš„è¡¨è¾¾è§„èŒƒã€‚åªè¿”å›ç¿»è¯‘ç»“æœã€‚',
                promptContentTechnical: 'ä½ æ˜¯ä¸€ä¸ªæŠ€æœ¯æ–‡æ¡£ç¿»è¯‘ä¸“å®¶ã€‚è¯·å°†ä»¥ä¸‹æŠ€æœ¯æ–‡æœ¬ç¿»è¯‘æˆ{targetLanguage}ï¼Œä¿æŒä¸“ä¸šæœ¯è¯­çš„å‡†ç¡®æ€§ã€‚åªè¿”å›ç¿»è¯‘ç»“æœã€‚',
                
                // æˆåŠŸ/é”™è¯¯æ¶ˆæ¯
                promptSaved: 'æç¤ºè¯ "{name}" å·²ä¿å­˜',
                promptDeleted: 'æç¤ºè¯ "{name}" å·²åˆ é™¤',
                promptSavedFailed: 'æç¤ºè¯åç§°å’Œå†…å®¹ä¸èƒ½ä¸ºç©º',
                modelSaved: 'æ¨¡å‹ "{name}" å·²ä¿å­˜',
                modelDeleted: 'æ¨¡å‹ "{name}" å·²åˆ é™¤',
                modelSavedFailed: 'è¯·å…ˆè¾“å…¥æ¨¡å‹åç§°',
                modelSavedDuplicate: 'æ¨¡å‹ "{name}" å·²å­˜åœ¨',
                modelSwitched: 'å·²åˆ‡æ¢åˆ°æ¨¡å‹: {modelName}',
                promptSwitched: 'å·²åˆ‡æ¢æç¤ºè¯æ¨¡æ¿',
                configSaved: 'é…ç½®å·²ä¿å­˜',
                languageSwitched: 'ç›®æ ‡è¯­è¨€å·²åˆ‡æ¢ä¸º: {language}',
                translationStarted: 'å¼€å§‹ç¿»è¯‘...',
                translationStopping: 'æ­£åœ¨åœæ­¢ç¿»è¯‘...',
                translationStopped: 'ç¿»è¯‘å·²åœæ­¢ - å·²å®Œæˆ {completed}/{total} ä¸ªæ–‡æœ¬',
                translationCompletedPartial: 'ç¿»è¯‘å®Œæˆï¼å·²å®Œæˆ {completed}/{total} ä¸ªæ–‡æœ¬ï¼ˆéƒ¨åˆ†å¤±è´¥ï¼‰',
                translationCompletedAll: 'ç¿»è¯‘å®Œæˆï¼æ‰€æœ‰æ–‡æœ¬ç¿»è¯‘æˆåŠŸ',
                
                // è¿›åº¦æ¶ˆæ¯è¯¦ç»†ç‰ˆæœ¬
                progressProcessingDetail: 'æ­£åœ¨å¤„ç† ({completed}/{total}): {currentText}',
                progressTranslatingDetail: 'ç¿»è¯‘è¿›åº¦: {completed}/{total} ({progress}%) - å·²å®Œæˆ: {currentText}',
                progressTranslatingSimple: 'ç¿»è¯‘è¿›åº¦: {completed}/{total} ({progress}%)',
                
                // è¯­è¨€åç§°
                languages: {
                    'zh-CN': 'ç®€ä½“ä¸­æ–‡',
                    'zh-TW': 'ç¹ä½“ä¸­æ–‡',
                    'en': 'è‹±è¯­',
                    'ja': 'æ—¥è¯­',
                    'ko': 'éŸ©è¯­',
                    'fr': 'æ³•è¯­',
                    'de': 'å¾·è¯­',
                    'es': 'è¥¿ç­ç‰™è¯­',
                    'ru': 'ä¿„è¯­',
                    'ar': 'é˜¿æ‹‰ä¼¯è¯­',
                    'pt': 'è‘¡è„ç‰™è¯­',
                    'it': 'æ„å¤§åˆ©è¯­',
                    'nl': 'è·å…°è¯­',
                    'sv': 'ç‘å…¸è¯­',
                    'da': 'ä¸¹éº¦è¯­',
                    'no': 'æŒªå¨è¯­',
                    'fi': 'èŠ¬å…°è¯­',
                    'pl': 'æ³¢å…°è¯­',
                    'cs': 'æ·å…‹è¯­',
                    'hu': 'åŒˆç‰™åˆ©è¯­',
                    'tr': 'åœŸè€³å…¶è¯­',
                    'th': 'æ³°è¯­',
                    'vi': 'è¶Šå—è¯­',
                    'hi': 'å°åœ°è¯­',
                    'he': 'å¸Œä¼¯æ¥è¯­',
                    'uk': 'ä¹Œå…‹å…°è¯­'
                }
            },
            
            'en': {
                // Main interface
                title: 'LUMI Translator',
                settings: 'Settings',
                selectedText: 'text layers selected',
                targetLanguage: 'Target Language',
                model: 'Model',
                promptTemplate: 'Prompt Template',
                startTranslation: 'Start Translation',
                stopTranslation: 'Stop Translation',
                
                // Settings dialog
                apiUrl: 'API URL',
                apiKey: 'API Key',
                prompt: 'Prompt',
                save: 'Save',
                close: 'Close',
                
                // Language selection
                language: 'Interface Language',
                
                // Placeholders
                placeholderApiUrl: 'https://api.openai.com/v1/chat/completions',
                placeholderApiKey: 'sk-...',
                placeholderModel: 'gpt-4.1-nano',
                placeholderPrompt: 'You are a professional translator...',
                placeholderPromptName: 'Name this prompt...',
                
                // Status messages
                statusConfigNeeded: 'Please configure API settings first',
                statusConfigured: 'Configuration complete',
                statusTranslating: 'Translating...',
                statusCompleted: 'Translation completed!',
                statusStopping: 'Stopping translation...',
                statusError: 'Translation error',
                
                // Progress messages
                progressProcessing: 'Processing',
                progressTranslating: 'Translation progress',
                
                // Prompt templates
                templateStandard: 'Standard',
                templateLocalization: 'Localization',
                templateUI: 'UI Text',
                templateTechnical: 'Technical',
                
                // Prompt templates content
                promptContentStandard: 'You are a professional translator. Please translate the text provided by the user into {targetLanguage}. Return only the translation, without any explanation or other content.',
                promptContentLocalization: 'You are a professional localizer. Please translate the following text into {targetLanguage}, maintaining the original tone and style, so that it fits the expression habits of the target language. Return only the translation.',
                promptContentUI: 'You are a UI/UX copywriter. Please translate the following interface text into {targetLanguage}, keeping it simple and clear, to fit the expression norms of the user interface. Return only the translation.',
                promptContentTechnical: 'You are a technical document translator. Please translate the following technical text into {targetLanguage}, maintaining the accuracy of professional terms. Return only the translation.',
                
                // Success/Error messages
                promptSaved: 'Prompt saved',
                promptDeleted: 'Prompt deleted',
                promptSavedFailed: 'Prompt name and content cannot be empty',
                modelSaved: 'Model "{name}" saved',
                modelDeleted: 'Model "{name}" deleted',
                modelSavedFailed: 'Please enter a model name first',
                modelSavedDuplicate: 'Model "{name}" already exists',
                modelSwitched: 'Switched to model: {modelName}',
                promptSwitched: 'Switched prompt template',
                configSaved: 'Configuration saved',
                languageSwitched: 'Target language switched to: {language}',
                translationStarted: 'Translation started...',
                translationStopping: 'Stopping translation...',
                translationStopped: 'Translation stopped - Completed {completed}/{total} texts',
                translationCompletedPartial: 'Translation completed! Finished {completed}/{total} texts (some failed)',
                translationCompletedAll: 'Translation completed! All texts translated successfully',
                
                // Progress messages
                progressProcessingDetail: 'Processing ({completed}/{total}): {currentText}',
                progressTranslatingDetail: 'Translation progress: {completed}/{total} ({progress}%) - Completed: {currentText}',
                progressTranslatingSimple: 'Translation progress: {completed}/{total} ({progress}%)',
                
                // Language names
                languages: {
                    'zh-CN': 'Simplified Chinese',
                    'zh-TW': 'Traditional Chinese', 
                    'en': 'English',
                    'ja': 'Japanese',
                    'ko': 'Korean',
                    'fr': 'French',
                    'de': 'German',
                    'es': 'Spanish',
                    'ru': 'Russian',
                    'ar': 'Arabic',
                    'pt': 'Portuguese',
                    'it': 'Italian',
                    'nl': 'Dutch',
                    'sv': 'Swedish',
                    'da': 'Danish',
                    'no': 'Norwegian',
                    'fi': 'Finnish',
                    'pl': 'Polish',
                    'cs': 'Czech',
                    'hu': 'Hungarian',
                    'tr': 'Turkish',
                    'th': 'Thai',
                    'vi': 'Vietnamese',
                    'hi': 'Hindi',
                    'he': 'Hebrew',
                    'uk': 'Ukrainian'
                }
            },
            
            'ja': {
                // ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
                title: 'LUMIç¿»è¨³ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ',
                settings: 'è¨­å®š',
                selectedText: 'ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã™',
                targetLanguage: 'ç¿»è¨³å…ˆè¨€èª',
                model: 'ãƒ¢ãƒ‡ãƒ«',
                promptTemplate: 'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ',
                startTranslation: 'ç¿»è¨³é–‹å§‹',
                stopTranslation: 'ç¿»è¨³åœæ­¢',
                
                // è¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚°
                apiUrl: 'API URL',
                apiKey: 'API ã‚­ãƒ¼',
                prompt: 'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ',
                save: 'ä¿å­˜',
                close: 'é–‰ã˜ã‚‹',
                
                // è¨€èªé¸æŠ
                language: 'ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨€èª',
                
                // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼
                placeholderApiUrl: 'https://api.openai.com/v1/chat/completions',
                placeholderApiKey: 'sk-...',
                placeholderModel: 'gpt-4.1-nano',
                placeholderPrompt: 'ã‚ãªãŸã¯å°‚é–€çš„ãªç¿»è¨³è€…ã§ã™...',
                placeholderPromptName: 'ã“ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«åå‰ã‚’ä»˜ã‘ã‚‹...',
                
                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                statusConfigNeeded: 'ã¾ãšAPIè¨­å®šã‚’æ§‹æˆã—ã¦ãã ã•ã„',
                statusConfigured: 'è¨­å®šå®Œäº†',
                statusTranslating: 'ç¿»è¨³ä¸­...',
                statusCompleted: 'ç¿»è¨³å®Œäº†ï¼',
                statusStopping: 'ç¿»è¨³ã‚’åœæ­¢ä¸­...',
                statusError: 'ç¿»è¨³ã‚¨ãƒ©ãƒ¼',
                
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                progressProcessing: 'å‡¦ç†ä¸­',
                progressTranslating: 'ç¿»è¨³é€²è¡ŒçŠ¶æ³',
                
                // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
                templateStandard: 'æ¨™æº–ç¿»è¨³',
                templateLocalization: 'ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³',
                templateUI: 'UIãƒ†ã‚­ã‚¹ãƒˆ',
                templateTechnical: 'æŠ€è¡“æ–‡æ›¸',
                
                // Prompt templates content
                promptContentStandard: 'ã‚ãªãŸã¯å°‚é–€çš„ãªç¿»è¨³è€…ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰æä¾›ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã‚’{targetLanguage}ã«ç¿»è¨³ã—ã¦ãã ã•ã„ã€‚ç¿»è¨³çµæœã®ã¿ã‚’è¿”ã—ã€èª¬æ˜ã‚„ãã®ä»–ã®å†…å®¹ã¯è¿½åŠ ã—ãªã„ã§ãã ã•ã„ã€‚',
                promptContentLocalization: 'ã‚ãªãŸã¯å°‚é–€çš„ãªãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚¶ãƒ¼ã§ã™ã€‚ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’{targetLanguage}ã«ç¿»è¨³ã—ã€åŸæ–‡ã®ãƒˆãƒ¼ãƒ³ã¨ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¶­æŒã—ã¦ã€ãã®è¨€èªã®è¡¨ç¾ç¿’æ…£ã«åˆã‚ã›ã¦ãã ã•ã„ã€‚ç¿»è¨³çµæœã®ã¿ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚',
                promptContentUI: 'ã‚ãªãŸã¯UI/UXã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ã‚¿ãƒ¼ã§ã™ã€‚ä»¥ä¸‹ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒ†ã‚­ã‚¹ãƒˆã‚’{targetLanguage}ã«ç¿»è¨³ã—ã€ã‚·ãƒ³ãƒ—ãƒ«ã§æ˜ç¢ºãªè¡¨ç¾ã«ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®è¡¨ç¾è¦ç¯„ã«åˆã‚ã›ã¦ãã ã•ã„ã€‚ç¿»è¨³çµæœã®ã¿ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚',
                promptContentTechnical: 'ã‚ãªãŸã¯æŠ€è¡“æ–‡æ›¸ç¿»è¨³å°‚é–€å®¶ã§ã™ã€‚ä»¥ä¸‹ã®æŠ€è¡“ãƒ†ã‚­ã‚¹ãƒˆã‚’{targetLanguage}ã«ç¿»è¨³ã—ã€å°‚é–€ç”¨èªã®æ­£ç¢ºæ€§ã‚’ç¶­æŒã—ã¦ãã ã•ã„ã€‚ç¿»è¨³çµæœã®ã¿ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚',
                
                // æˆåŠŸ/ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                promptSaved: 'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒä¿å­˜ã•ã‚Œã¾ã—ãŸ',
                promptDeleted: 'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ',
                promptSavedFailed: 'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®åå‰ã¨å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
                modelSaved: 'ãƒ¢ãƒ‡ãƒ«"{name}"ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸ',
                modelDeleted: 'ãƒ¢ãƒ‡ãƒ«"{name}"ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ',
                modelSavedFailed: 'ã¾ãšãƒ¢ãƒ‡ãƒ«ã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
                modelSavedDuplicate: 'ãƒ¢ãƒ‡ãƒ«"{name}"ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™',
                modelSwitched: 'ãƒ¢ãƒ‡ãƒ«: {modelName}ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ',
                promptSwitched: 'ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ',
                configSaved: 'è¨­å®šãŒä¿å­˜ã•ã‚Œã¾ã—ãŸ',
                languageSwitched: 'å¯¾è±¡è¨€èªãŒ{language}ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ',
                translationStarted: 'ç¿»è¨³é–‹å§‹...',
                translationStopping: 'ç¿»è¨³ã‚’åœæ­¢ä¸­...',
                translationStopped: 'ç¿»è¨³ãŒåœæ­¢ã•ã‚Œã¾ã—ãŸ - {completed}/{total}å€‹ã®ãƒ†ã‚­ã‚¹ãƒˆãŒå®Œäº†',
                translationCompletedPartial: 'ç¿»è¨³å®Œäº†ï¼{completed}/{total}å€‹ã®ãƒ†ã‚­ã‚¹ãƒˆãŒå®Œäº†ï¼ˆä¸€éƒ¨å¤±æ•—ï¼‰',
                translationCompletedAll: 'ç¿»è¨³å®Œäº†ï¼ã™ã¹ã¦ã®ãƒ†ã‚­ã‚¹ãƒˆãŒæ­£å¸¸ã«ç¿»è¨³ã•ã‚Œã¾ã—ãŸ',
                
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è©³ç´°ç‰ˆ
                progressProcessingDetail: 'å‡¦ç†ä¸­ ({completed}/{total}): {currentText}',
                progressTranslatingDetail: 'ç¿»è¨³é€²è¡ŒçŠ¶æ³: {completed}/{total} ({progress}%) - å®Œäº†: {currentText}',
                progressTranslatingSimple: 'ç¿»è¨³é€²è¡ŒçŠ¶æ³: {completed}/{total} ({progress}%)',
                
                // è¨€èªå
                languages: {
                    'zh-CN': 'ç°¡ä½“å­—ä¸­å›½èª',
                    'zh-TW': 'ç¹ä½“å­—ä¸­å›½èª',
                    'en': 'è‹±èª',
                    'ja': 'æ—¥æœ¬èª',
                    'ko': 'éŸ“å›½èª',
                    'fr': 'ãƒ•ãƒ©ãƒ³ã‚¹èª',
                    'de': 'ãƒ‰ã‚¤ãƒ„èª',
                    'es': 'ã‚¹ãƒšã‚¤ãƒ³èª',
                    'ru': 'ãƒ­ã‚·ã‚¢èª',
                    'ar': 'ã‚¢ãƒ©ãƒ“ã‚¢èª',
                    'pt': 'ãƒãƒ«ãƒˆã‚¬ãƒ«èª',
                    'it': 'ã‚¤ã‚¿ãƒªã‚¢èª',
                    'nl': 'ã‚ªãƒ©ãƒ³ãƒ€èª',
                    'sv': 'ã‚¹ã‚¦ã‚§ãƒ¼ãƒ‡ãƒ³èª',
                    'da': 'ãƒ‡ãƒ³ãƒãƒ¼ã‚¯èª',
                    'no': 'ãƒãƒ«ã‚¦ã‚§ãƒ¼èª',
                    'fi': 'ãƒ•ã‚£ãƒ³ãƒ©ãƒ³ãƒ‰èª',
                    'pl': 'ãƒãƒ¼ãƒ©ãƒ³ãƒ‰èª',
                    'cs': 'ãƒã‚§ã‚³èª',
                    'hu': 'ãƒãƒ³ã‚¬ãƒªãƒ¼èª',
                    'tr': 'ãƒˆãƒ«ã‚³èª',
                    'th': 'ã‚¿ã‚¤èª',
                    'vi': 'ãƒ™ãƒˆãƒŠãƒ èª',
                    'hi': 'ãƒ’ãƒ³ãƒ‡ã‚£ãƒ¼èª',
                    'he': 'ãƒ˜ãƒ–ãƒ©ã‚¤èª',
                    'uk': 'ã‚¦ã‚¯ãƒ©ã‚¤ãƒŠèª'
                }
            }
        };
        
        // å½“å‰è¯­è¨€è®¾ç½®
        let currentUILanguage = 'zh-CN';
        
        // i18n åŠŸèƒ½
        function t(key, replacements = {}) {
            const keys = key.split('.');
            let value = i18nData[currentUILanguage];
            
            for (const k of keys) {
                if (value && typeof value === 'object') {
                    value = value[k];
                } else {
                    break;
                }
            }
            
            if (typeof value !== 'string') {
                // å›é€€åˆ°ä¸­æ–‡
                value = i18nData['zh-CN'];
                for (const k of keys) {
                    if (value && typeof value === 'object') {
                        value = value[k];
                    } else {
                        break;
                    }
                }
            }
            
            if (typeof value === 'string') {
                // æ›¿æ¢å ä½ç¬¦
                return value.replace(/\{(\w+)\}/g, (match, key) => {
                    return replacements[key] !== undefined ? replacements[key] : match;
                });
            }
            
            return key; // å¦‚æœæ‰¾ä¸åˆ°ç¿»è¯‘ï¼Œè¿”å›é”®å
        }
        
        // æ›´æ–°ç•Œé¢è¯­è¨€
        function updateUILanguage() {
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.title = t('title');
            
            // æ›´æ–°æ‰€æœ‰å¸¦æœ‰ data-i18n å±æ€§çš„å…ƒç´ 
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                element.textContent = t(key);
            });
            
            // æ›´æ–°æ‰€æœ‰å¸¦æœ‰ data-i18n-placeholder å±æ€§çš„å…ƒç´ 
            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                element.placeholder = t(key);
            });
            
            // æ›´æ–°æ‰€æœ‰å¸¦æœ‰ data-i18n-title å±æ€§çš„å…ƒç´ 
            document.querySelectorAll('[data-i18n-title]').forEach(element => {
                const key = element.getAttribute('data-i18n-title');
                element.title = t(key);
            });
            
            // æ›´æ–°ç¿»è¯‘ç›®æ ‡è¯­è¨€ä¸‹æ‹‰æ¡†çš„é€‰é¡¹æ–‡æœ¬
            const targetLanguageSelect = document.getElementById('targetLanguage');
            if (targetLanguageSelect) {
                targetLanguageSelect.querySelectorAll('option').forEach(option => {
                    const langKey = option.value;
                    if (langKey && t('languages.' + langKey)) {
                        const flag = option.textContent.match(/ğŸ‡¨ğŸ‡³|ğŸ‡¹ğŸ‡¼|ğŸ‡ºğŸ‡¸|ğŸ‡¯ğŸ‡µ|ğŸ‡°ğŸ‡·|ğŸ‡«ğŸ‡·|ğŸ‡©ğŸ‡ª|ğŸ‡ªğŸ‡¸|ğŸ‡·ğŸ‡º|ğŸ‡¸ğŸ‡¦|ğŸ‡µğŸ‡¹|ğŸ‡®ğŸ‡¹|ğŸ‡³ğŸ‡±|ğŸ‡¸ğŸ‡ª|ğŸ‡©ğŸ‡°|ğŸ‡³ğŸ‡´|ğŸ‡«ğŸ‡®|ğŸ‡µğŸ‡±|ğŸ‡¨ğŸ‡¿|ğŸ‡­ğŸ‡º|ğŸ‡¹ğŸ‡·|ğŸ‡¹ğŸ‡­|ğŸ‡»ğŸ‡³|ğŸ‡®ğŸ‡³|ğŸ‡®ğŸ‡±|ğŸ‡ºğŸ‡¦/);
                        const flagText = flag ? ' ' + flag[0] : '';
                        option.textContent = t('languages.' + langKey) + flagText;
                    }
                });
            }
            
            // æ›´æ–°å¿«é€Ÿæç¤ºè¯é€‰æ‹©æ¡†çš„é€‰é¡¹æ–‡æœ¬
            const quickPromptSelect = document.getElementById('quickPromptSelect');
            if (quickPromptSelect) {
                quickPromptSelect.querySelectorAll('option').forEach(option => {
                    const value = option.value;
                    if (value && !value.startsWith('custom_')) {
                        // æ›´æ–°é¢„è®¾æç¤ºè¯é€‰é¡¹çš„æ–‡æœ¬
                        const templateNames = {
                            'standard': 'templateStandard',
                            'localization': 'templateLocalization', 
                            'ui': 'templateUI',
                            'technical': 'templateTechnical'
                        };
                        if (templateNames[value]) {
                            option.textContent = t(templateNames[value]);
                        }
                    }
                });
            }
            
            // æ›´æ–°è®¾ç½®å¼¹çª—ä¸­çš„æç¤ºè¯æ¨¡æ¿å†…å®¹
            const promptTags = document.querySelectorAll('.prompt-templates .prompt-tag:not(.custom-prompt-tag)');
            promptTags.forEach(tag => {
                // æ ¹æ®data-template-typeå±æ€§ç¡®å®šæ¨¡æ¿ç±»å‹
                const templateType = tag.getAttribute('data-template-type');
                const promptContentKeys = {
                    'standard': 'promptContentStandard',
                    'localization': 'promptContentLocalization',
                    'ui': 'promptContentUI',
                    'technical': 'promptContentTechnical'
                };
                
                if (promptContentKeys[templateType]) {
                    const newPromptContent = t(promptContentKeys[templateType]);
                    tag.setAttribute('data-prompt', newPromptContent);
                }
            });
        }
        
        // åˆå§‹åŒ–è¯­è¨€è®¾ç½®
        async function initLanguage() {
            // ä»å­˜å‚¨ä¸­åŠ è½½è¯­è¨€è®¾ç½®
            try {
                const savedLanguage = localStorage.getItem('ui-language');
                if (savedLanguage && i18nData[savedLanguage]) {
                    currentUILanguage = savedLanguage;
                }
            } catch (e) {
                console.log('Could not load language setting:', e);
            }
            
            // è®¾ç½®UIè¯­è¨€é€‰æ‹©æ¡†çš„å€¼
            const uiLanguageSelect = document.getElementById('uiLanguage');
            if (uiLanguageSelect) {
                uiLanguageSelect.value = currentUILanguage;
            }
            
            updateUILanguage();
            
            // ç¡®ä¿ä¸‹æ‹‰æ¡†é€‰é¡¹æ–‡æœ¬ä¹Ÿå¾—åˆ°æ›´æ–°
            setTimeout(() => {
                if (typeof renderQuickPromptSelect === 'function') {
                    renderQuickPromptSelect();
                }
                // åˆå§‹åŒ–å®Œæˆåè°ƒæ•´é«˜åº¦
                adjustUIHeight();
            }, 100);
        }
        
        // åˆ‡æ¢è¯­è¨€
        function changeLanguage(language) {
            if (i18nData[language]) {
                currentUILanguage = language;
                try {
                    localStorage.setItem('ui-language', language);
                } catch (e) {
                    console.log('Could not save language setting:', e);
                }
                updateUILanguage();
                
                // æ›´æ–°è¯­è¨€ä¸‹æ‹‰æ¡†çš„é€‰ä¸­çŠ¶æ€
                const langSelect = document.getElementById('uiLanguage');
                if (langSelect) {
                    langSelect.value = language;
                }
                
                // è¯­è¨€åˆ‡æ¢åè°ƒæ•´é«˜åº¦
                setTimeout(() => {
                    adjustUIHeight();
                }, 100);
            }
        }
        
        // è®¡ç®—å¹¶è°ƒæ•´UIé«˜åº¦
        function adjustUIHeight() {
            try {
                // è®¡ç®—å®é™…å†…å®¹é«˜åº¦
                const container = document.querySelector('.container');
                if (!container) return;
                
                // è·å–å®¹å™¨çš„å®é™…é«˜åº¦
                const containerHeight = container.scrollHeight;
                // åŠ ä¸Šbodyçš„paddingï¼ˆä¸Šä¸‹å„16pxï¼‰
                const totalHeight = containerHeight + 32;
                
                // é™åˆ¶é«˜åº¦èŒƒå›´ï¼šæœ€å°400pxï¼Œæœ€å¤§800px
                const clampedHeight = Math.min(Math.max(totalHeight, 400), 800);
                
                // å‘é€è°ƒæ•´é«˜åº¦çš„æ¶ˆæ¯ç»™ä¸»çº¿ç¨‹
                parent.postMessage({
                    pluginMessage: {
                        type: 'resize-ui',
                        width: 400,
                        height: clampedHeight
                    }
                }, '*');
            } catch (error) {
                console.log('Failed to adjust UI height:', error);
            }
        }
    </script>
    
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 12px;
            line-height: 1.4;
            color: #333;
            padding: 16px;
            margin: 0;
            min-height: 400px;
            max-height: 80vh;
            height: auto;
            overflow-y: auto;
            box-sizing: border-box;
        }

        .container {
            background: white;
            border-radius: 8px;
            height: auto;
            min-height: 100%;
            display: flex;
            flex-direction: column;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .title {
            font-size: 14px;
            font-weight: 600;
            color: #1a1a1a;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 4px 4px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            color: #666;
        }

        .settings-btn:hover {
            background: #e9ecef;
            color: #333;
        }

        .settings-btn.active {
            background: #007AFF;
            color: white;
            border-color: #007AFF;
        }

        h2 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #1a1a1a;
            border-bottom: 2px solid #007AFF;
            padding-bottom: 8px;
        }

        .form-group {
            margin-bottom: 8px;
        }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: 6px;
            color: #555;
            font-size: 13px;
        }

        input, select, textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
            transition: border-color 0.2s;
        }

        /* ä¼˜åŒ–ä¸‹æ‹‰åˆ—è¡¨æ ·å¼ */
        select {
            background: white;
            padding: 10px 36px 10px 12px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 9L1.5 4.5h9L6 9z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            cursor: pointer;
            font-weight: 500;
        }

        select:hover {
            border-color: #007AFF;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23007AFF' d='M6 9L1.5 4.5h9L6 9z'/%3E%3C/svg%3E");
        }

        select:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23007AFF' d='M6 9L1.5 4.5h9L6 9z'/%3E%3C/svg%3E");
        }

        /* ä¸‹æ‹‰é€‰é¡¹æ ·å¼ */
        select option {
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 400;
            background: white;
            color: #333;
        }

        select option:hover {
            background: #f8f9fa;
        }

        select option:checked {
            background: #007AFF;
            color: white;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
            line-height: 1.4;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow: 0 0 0 2px rgba(0,122,255,0.1);
        }

        /* è¡¨å•å®¹å™¨æ ·å¼ä¼˜åŒ– */
        .select-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .select-icon {
            position: absolute;
            left: 12px;
            color: #666;
            pointer-events: none;
            z-index: 1;
        }

        .select-container select {
            padding-left: 40px;
        }

        .select-container:hover .select-icon {
            color: #007AFF;
        }

        .select-container select:focus + .select-icon,
        .select-container select:focus ~ .select-icon {
            color: #007AFF;
        }

        .btn {
            display: inline-block;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            width: 100%;
            padding: 12px 20px;
        }

        .btn-primary {
            background: #007AFF;
            color: white;
            font-size: 16px;
        }

        .btn-primary:hover:not(:disabled) {
            background: #0056CC;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            font-size: 16px;
            padding: 14px 24px;
        }

        .btn-danger:hover:not(:disabled) {
            background: #c82333;
        }

        .btn-secondary {
            background: #f1f3f5;
            color: #495057;
            border: 1px solid #dee2e6;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #e9ecef;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .status {
            padding: 8px 12px;
            border-radius: 6px;
            margin: 12px 0;
            font-size: 11px;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #99d5ff;
        }

        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .progress {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin: 16px 0;
        }

        .progress-bar {
            height: 100%;
            background: #007AFF;
            transition: width 0.3s ease;
            width: 0%;
        }

        .section {
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .help-text {
            font-size: 10px;
            color: #666;
            margin-top: 4px;
        }

        .loading {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .spinner {
            width: 14px;
            height: 14px;
            border: 2px solid #e9ecef;
            border-top: 2px solid #007AFF;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        /* Material Symbols æ ·å¼ */
        .material-symbols-outlined {
            font-family: 'Material Symbols Outlined';
            font-weight: normal;
            font-style: normal;
            font-size: 18px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
        }

        .icon-small {
            font-size: 16px;
        }

        .icon-large {
            font-size: 20px;
        }

        /* è®¾ç½®å¼¹çª—æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            min-height: 300px;
            max-height: 85vh;
            height: auto;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            transform: scale(0.7);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .modal-overlay.show .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px 16px;
            border-bottom: 1px solid #e9ecef;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .close-btn {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 4px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: #f8f9fa;
            color: #333;
        }

        .modal-body {
            padding: 24px;
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }

        .modal-body .btn {
            width: 100%;
            margin-top: 8px;
        }

        .config-status {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: #f8f9fa;
            border-radius: 50px;
            font-size: 11px;
        }

        .config-status.configured {
            background: #d4edda;
            color: #155724;
        }

        .config-status.not-configured {
            background: #fff3cd;
            color: #856404;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #dc3545;
        }

        .status-indicator.configured {
            background: #28a745;
        }

        .model-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 3px 12px;
            background: #f3e5f5;
            border-radius: 50px;
            font-size: 12px;
            color: #4a148c;
        }

        .language-section {
            background: #fff;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .language-title {
            font-size: 14px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .information{
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .selection-info {
            background: #e8f4fd;
            border: 1px solid #bee5eb;
            border-radius: 6px;
            padding: 24px;
            text-align: center;
            margin-bottom: 24px;
        }

        .selection-count {
            font-size: 24px;
            font-weight: 700;
            color: #007AFF;
            margin-bottom: 4px;
        }

        .selection-text {
            font-size: 12px;
            color: #666;
        }

        .translate-section {
            display: flex;
            align-items: center;
        }

        .progress-info {
            text-align: center;
            margin: 8px 0;
            font-size: 12px;
            color: #666;
        }

        .btn-stop {
            background: #dc3545;
            color: white;
            font-size: 16px;
            padding: 14px 24px;
        }

        .btn-stop:hover:not(:disabled) {
            background: #c82333;
        }

        .stop-spinner {
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .prompt-templates {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        .prompt-tag {
            background: #e8f5e8;
            color: #2d5a2d;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .prompt-tag:hover {
            background: #d4edda;
            transform: translateY(-1px);
        }

        /* ä¿å­˜è‡ªå®šä¹‰æ¨¡æ¿æ ·å¼ */
        .save-prompt-section {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e9ecef;
        }

        .save-prompt-input {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .save-prompt-input input {
            flex-grow: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
        }

        .save-prompt-input input:focus {
            outline: none;
            border-color: #007AFF;
        }

        .btn-save-prompt {
            background: #007AFF;
            color: white;
            border: none;
            font-size: 12px;
            padding: 8px 12px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-save-prompt:hover:not(:disabled) {
            background: #0056CC;
        }

        .btn-save-prompt:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* è‡ªå®šä¹‰æç¤ºè¯æ ·å¼ */
        .custom-prompt-tag {
            background: #e0f2f7;
            color: #0056b3;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            position: relative;
        }

        .custom-prompt-tag:hover {
            background: #cce5ff;
            transform: translateY(-1px);
        }

        .delete-prompt {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 2px;
            border-radius: 50%;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            margin-left: 4px;
        }

        .delete-prompt:hover {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }

        .delete-prompt .material-symbols-outlined {
            font-size: 12px;
        }

        /* æ¨¡å‹è¾“å…¥å®¹å™¨æ ·å¼ */
        .model-input-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .model-input-container input {
            flex-grow: 1;
        }

        .btn-quick-save {
            background: #007AFF;
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .btn-quick-save:hover:not(:disabled) {
            background: #0056CC;
            transform: scale(1.05);
        }

        .btn-quick-save:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .model-templates {
            margin-top: 8px;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .model-tag {
            background: #e8f5e8;
            color: #2d5a2d;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            position: relative;
        }

        .model-tag:hover {
            background: #d4edda;
            transform: translateY(-1px);
        }

        .delete-model {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 2px;
            border-radius: 50%;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            margin-left: 4px;
        }

        .delete-model:hover {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }

        .delete-model .material-symbols-outlined {
            font-size: 12px;
        }

        /* è‡ªå®šä¹‰æ¨¡å‹æ ‡ç­¾æ ·å¼ */
        .custom-model-tag {
            background: #fff3e0;
            color: #e65100;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            position: relative;
        }

        .custom-model-tag:hover {
            background: #ffe0b2;
            transform: translateY(-1px);
        }

        /* å¿«é€Ÿåˆ‡æ¢åŒºåŸŸæ ·å¼ */
        .quick-switch-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 16px 0 20px;
            padding: 16px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
        }

        .quick-switch-item {
            text-align: left;
        }

        .quick-switch-title {
            font-size: 12px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨åŒºåŸŸ -->
        <div class="header">
            <div class="title">
                <span class="material-symbols-outlined">translate</span>
                <span data-i18n="title">LUMIç¿»è¯‘åŠ©æ‰‹</span>
            </div>
            <div style="display: flex; gap: 8px; align-items: center;">
                <!-- è¯­è¨€åˆ‡æ¢ -->
                <select id="uiLanguage" onchange="changeLanguage(this.value)" style="display: flex; width: auto; padding: 6px 8px; font-size: 11px; border: 1px solid #dee2e6; border-radius: 4px; background: #f8f9fa;">
                    <option value="zh-CN">ä¸­æ–‡</option>
                    <option value="en">English</option>
                    <option value="ja">æ—¥æœ¬èª</option>
                </select>
                <button class="settings-btn" id="settingsToggle">
                    <span class="material-symbols-outlined icon-small">settings</span>
                </button>
            </div>
        </div>

        <!-- é€‰ä¸­æ–‡æœ¬ä¿¡æ¯ -->
        <div class="selection-info">
            <div class="selection-count" id="selectionCount">0</div>
            <div class="selection-text" data-i18n="selectedText">ä¸ªæ–‡æœ¬å›¾å±‚å·²é€‰ä¸­</div>
        </div>

        <!-- ç›®æ ‡è¯­è¨€é€‰æ‹© -->
        <div class="language-section">
            <div class="language-title">
                <span class="material-symbols-outlined icon-small">language</span>
                <span data-i18n="targetLanguage">ç¿»è¯‘ç›®æ ‡è¯­è¨€</span>
            </div>
            <div class="form-group">
                <div class="select-container">
                    <span class="material-symbols-outlined icon-small select-icon">public</span>
                    <select id="targetLanguage">
                        <option value="zh-CN">ç®€ä½“ä¸­æ–‡ ğŸ‡¨ğŸ‡³</option>
                        <option value="zh-TW">ç¹ä½“ä¸­æ–‡ ğŸ‡¹ğŸ‡¼</option>
                        <option value="en">è‹±è¯­ ğŸ‡ºğŸ‡¸</option>
                        <option value="ja">æ—¥è¯­ ğŸ‡¯ğŸ‡µ</option>
                        <option value="ko">éŸ©è¯­ ğŸ‡°ğŸ‡·</option>
                        <option value="fr">æ³•è¯­ ğŸ‡«ğŸ‡·</option>
                        <option value="de">å¾·è¯­ ğŸ‡©ğŸ‡ª</option>
                        <option value="es">è¥¿ç­ç‰™è¯­ ğŸ‡ªğŸ‡¸</option>
                        <option value="ru">ä¿„è¯­ ğŸ‡·ğŸ‡º</option>
                        <option value="ar">é˜¿æ‹‰ä¼¯è¯­ ğŸ‡¸ğŸ‡¦</option>
                        <option value="pt">è‘¡è„ç‰™è¯­ ğŸ‡µğŸ‡¹</option>
                        <option value="it">æ„å¤§åˆ©è¯­ ğŸ‡®ğŸ‡¹</option>
                        <option value="nl">è·å…°è¯­ ğŸ‡³ğŸ‡±</option>
                        <option value="sv">ç‘å…¸è¯­ ğŸ‡¸ğŸ‡ª</option>
                        <option value="da">ä¸¹éº¦è¯­ ğŸ‡©ğŸ‡°</option>
                        <option value="no">æŒªå¨è¯­ ğŸ‡³ğŸ‡´</option>
                        <option value="fi">èŠ¬å…°è¯­ ğŸ‡«ğŸ‡®</option>
                        <option value="pl">æ³¢å…°è¯­ ğŸ‡µğŸ‡±</option>
                        <option value="cs">æ·å…‹è¯­ ğŸ‡¨ğŸ‡¿</option>
                        <option value="hu">åŒˆç‰™åˆ©è¯­ ğŸ‡­ğŸ‡º</option>
                        <option value="tr">åœŸè€³å…¶è¯­ ğŸ‡¹ğŸ‡·</option>
                        <option value="th">æ³°è¯­ ğŸ‡¹ğŸ‡­</option>
                        <option value="vi">è¶Šå—è¯­ ğŸ‡»ğŸ‡³</option>
                        <option value="hi">å°åœ°è¯­ ğŸ‡®ğŸ‡³</option>
                        <option value="he">å¸Œä¼¯æ¥è¯­ ğŸ‡®ğŸ‡±</option>
                        <option value="uk">ä¹Œå…‹å…°è¯­ ğŸ‡ºğŸ‡¦</option>
                    </select>
                </div>
            </div>
            <div class="information">
                <!-- é…ç½®çŠ¶æ€æ˜¾ç¤º -->
                <div id="configStatus" class="config-status not-configured">
                    <div class="status-indicator" id="statusIndicator"></div>
                    <span id="statusText" data-i18n="statusConfigNeeded">è¯·å…ˆé…ç½®APIè®¾ç½®</span>
                </div>

                <div id="modelInfo" class="model-info hidden">
                    <span class="material-symbols-outlined icon-small">smart_toy</span>
                    <span id="currentModel">gpt-4.1-nano</span>
                </div>
            </div>
        </div>

        <!-- å¿«é€Ÿåˆ‡æ¢åŒºåŸŸ -->
        <div class="quick-switch-section">
            <!-- æ¨¡å‹å¿«é€Ÿåˆ‡æ¢ -->
            <div class="quick-switch-item">
                <div class="quick-switch-title">
                    <span class="material-symbols-outlined icon-small">smart_toy</span>
                    <span data-i18n="model">æ¨¡å‹</span>
                </div>
                <div class="select-container">
                    <span class="material-symbols-outlined icon-small select-icon">smart_toy</span>
                    <select id="quickModelSelect">
                        <option value="gpt-4.1-nano">gpt-4.1-nano</option>
                        <!-- è‡ªå®šä¹‰æ¨¡å‹é€‰é¡¹å°†åŠ¨æ€æ’å…¥ -->
                    </select>
                </div>
            </div>

            <!-- æç¤ºè¯æ¨¡æ¿å¿«é€Ÿåˆ‡æ¢ -->
            <div class="quick-switch-item">
                <div class="quick-switch-title">
                    <span class="material-symbols-outlined icon-small">psychology</span>
                    <span data-i18n="promptTemplate">æç¤ºè¯æ¨¡æ¿</span>
                </div>
                <div class="select-container">
                    <span class="material-symbols-outlined icon-small select-icon">edit_note</span>
                    <select id="quickPromptSelect">
                        <option value="standard" data-i18n="templateStandard">æ ‡å‡†ç¿»è¯‘</option>
                        <option value="localization" data-i18n="templateLocalization">æœ¬åœ°åŒ–</option>
                        <option value="ui" data-i18n="templateUI">ç•Œé¢æ–‡æ¡ˆ</option>
                        <option value="technical" data-i18n="templateTechnical">æŠ€æœ¯æ–‡æ¡£</option>
                        <!-- è‡ªå®šä¹‰æç¤ºè¯é€‰é¡¹å°†åŠ¨æ€æ’å…¥ -->
                    </select>
                </div>
            </div>
        </div>

        <!-- ç¿»è¯‘éƒ¨åˆ† -->
        <div class="translate-section">
            <button class="btn btn-primary" id="translateBtn" disabled>
                <span class="material-symbols-outlined icon-small">rocket_launch</span>
                <span data-i18n="startTranslation">å¼€å§‹ç¿»è¯‘</span>
            </button>
            
            <div id="progress" class="progress hidden">
                <div id="progressBar" class="progress-bar"></div>
            </div>
            <div id="progressInfo" class="progress-info hidden"></div>
        </div>

        <!-- çŠ¶æ€æ˜¾ç¤º -->
        <div id="status"></div>
    </div>

    <!-- è®¾ç½®å¼¹çª— -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-symbols-outlined">settings</span>
                    <span data-i18n="settings">è®¾ç½®</span>
                </div>
                <button class="close-btn" id="closeModal">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="apiUrl" data-i18n="apiUrl">APIåœ°å€</label>
                    <input type="text" id="apiUrl" data-i18n-placeholder="placeholderApiUrl" placeholder="https://api.openai.com/v1/chat/completions">
                </div>
                
                <div class="form-group">
                    <label for="apiKey" data-i18n="apiKey">APIå¯†é’¥</label>
                    <input type="password" id="apiKey" data-i18n-placeholder="placeholderApiKey" placeholder="sk-...">
                </div>
                
                <div class="form-group">
                    <label for="modelName" data-i18n="model">æ¨¡å‹</label>
                    <div class="model-input-container">
                        <input type="text" id="modelName" data-i18n-placeholder="placeholderModel" placeholder="gpt-4.1-nano">
                        <button class="btn-quick-save" id="quickSaveModelBtn" data-i18n-title="save" title="ä¿å­˜å½“å‰æ¨¡å‹">
                            <span class="material-symbols-outlined icon-small">add</span>
                        </button>
                    </div>
                    
                    <div class="model-templates">
                        <!-- è‡ªå®šä¹‰æ¨¡å‹å°†åŠ¨æ€æ’å…¥åˆ°è¿™é‡Œ -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="customPrompt" data-i18n="prompt">æç¤ºè¯</label>
                    <textarea id="customPrompt" data-i18n-placeholder="placeholderPrompt" placeholder="ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç¿»è¯‘åŠ©æ‰‹..."></textarea>
                    
                    <!-- ä¿å­˜è‡ªå®šä¹‰æ¨¡æ¿åŒºåŸŸ -->
                    <div class="save-prompt-section">
                        <div class="save-prompt-input">
                            <input type="text" id="promptName" data-i18n-placeholder="placeholderPromptName" placeholder="ä¸ºæ­¤æç¤ºè¯å‘½å..." maxlength="20">
                            <button class="btn-save-prompt" id="savePromptBtn">
                                <span class="material-symbols-outlined icon-small">bookmark_add</span>
                                <span data-i18n="save">ä¿å­˜</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="prompt-templates">
                        <span class="prompt-tag" data-template-type="standard" data-prompt="ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç¿»è¯‘åŠ©æ‰‹ã€‚è¯·å°†ç”¨æˆ·æä¾›çš„æ–‡æœ¬ç¿»è¯‘æˆ{targetLanguage}ã€‚åªè¿”å›ç¿»è¯‘ç»“æœï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæˆ–å…¶ä»–å†…å®¹ã€‚" data-i18n="templateStandard">æ ‡å‡†</span>
                        <span class="prompt-tag" data-template-type="localization" data-prompt="ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æœ¬åœ°åŒ–ä¸“å®¶ã€‚è¯·å°†ä»¥ä¸‹æ–‡æœ¬ç¿»è¯‘æˆ{targetLanguage}ï¼Œä¿æŒåŸæ–‡çš„è¯­æ°”å’Œé£æ ¼ï¼Œä½¿å…¶ç¬¦åˆç›®æ ‡è¯­è¨€çš„è¡¨è¾¾ä¹ æƒ¯ã€‚åªè¿”å›ç¿»è¯‘ç»“æœã€‚" data-i18n="templateLocalization">æœ¬åœ°åŒ–</span>
                        <span class="prompt-tag" data-template-type="ui" data-prompt="ä½ æ˜¯ä¸€ä¸ªUI/UXæ–‡æ¡ˆä¸“å®¶ã€‚è¯·å°†ä»¥ä¸‹ç•Œé¢æ–‡æœ¬ç¿»è¯‘æˆ{targetLanguage}ï¼Œè¦æ±‚ç®€æ´æ˜äº†ï¼Œç¬¦åˆç”¨æˆ·ç•Œé¢çš„è¡¨è¾¾è§„èŒƒã€‚åªè¿”å›ç¿»è¯‘ç»“æœã€‚" data-i18n="templateUI">ç•Œé¢</span>
                        <span class="prompt-tag" data-template-type="technical" data-prompt="ä½ æ˜¯ä¸€ä¸ªæŠ€æœ¯æ–‡æ¡£ç¿»è¯‘ä¸“å®¶ã€‚è¯·å°†ä»¥ä¸‹æŠ€æœ¯æ–‡æœ¬ç¿»è¯‘æˆ{targetLanguage}ï¼Œä¿æŒä¸“ä¸šæœ¯è¯­çš„å‡†ç¡®æ€§ã€‚åªè¿”å›ç¿»è¯‘ç»“æœã€‚" data-i18n="templateTechnical">æŠ€æœ¯</span>
                        <!-- è‡ªå®šä¹‰æ¨¡æ¿å°†åŠ¨æ€æ’å…¥åˆ°è¿™é‡Œ -->
                    </div>
                </div>
                
                <button class="btn btn-secondary" id="saveConfig">
                    <span class="material-symbols-outlined icon-small">save</span>
                    <span data-i18n="save">ä¿å­˜</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€
        let selectedCount = 0;
        let isTranslating = false;
        let config = {
            apiUrl: '',
            apiKey: '',
            modelName: 'gpt-4.1-nano',
            targetLanguage: 'zh-CN',
            customPrompt: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç¿»è¯‘åŠ©æ‰‹ã€‚è¯·å°†ç”¨æˆ·æä¾›çš„æ–‡æœ¬ç¿»è¯‘æˆ{targetLanguage}ã€‚åªè¿”å›ç¿»è¯‘ç»“æœï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæˆ–å…¶ä»–å†…å®¹ã€‚',
            customPrompts: [],
            customModels: []
        };

        // DOM å…ƒç´ 
        const elements = {
            apiUrl: document.getElementById('apiUrl'),
            apiKey: document.getElementById('apiKey'),
            modelName: document.getElementById('modelName'),
            customPrompt: document.getElementById('customPrompt'),
            targetLanguage: document.getElementById('targetLanguage'),
            saveConfig: document.getElementById('saveConfig'),
            translateBtn: document.getElementById('translateBtn'),
            status: document.getElementById('status'),
            progress: document.getElementById('progress'),
            progressBar: document.getElementById('progressBar'),
            progressInfo: document.getElementById('progressInfo'),
            settingsToggle: document.getElementById('settingsToggle'),
            settingsModal: document.getElementById('settingsModal'),
            closeModal: document.getElementById('closeModal'),
            configStatus: document.getElementById('configStatus'),
            statusIndicator: document.getElementById('statusIndicator'),
            statusText: document.getElementById('statusText'),
            modelInfo: document.getElementById('modelInfo'),
            currentModel: document.getElementById('currentModel'),
            selectionCount: document.getElementById('selectionCount'),
            promptName: document.getElementById('promptName'),
            savePromptBtn: document.getElementById('savePromptBtn'),
            promptTemplates: document.querySelector('.prompt-templates'), // è·å–æç¤ºè¯æ¨¡æ¿å®¹å™¨
            quickSaveModelBtn: document.getElementById('quickSaveModelBtn'),
            modelTemplates: document.querySelector('.model-templates'), // è·å–æ¨¡å‹æ¨¡æ¿å®¹å™¨
            quickModelSelect: document.getElementById('quickModelSelect'), // è·å–æ¨¡å‹å¿«é€Ÿåˆ‡æ¢ä¸‹æ‹‰æ¡†
            quickPromptSelect: document.getElementById('quickPromptSelect') // è·å–æç¤ºè¯å¿«é€Ÿåˆ‡æ¢ä¸‹æ‹‰æ¡†
        };

        // è¯­è¨€åç§°æ˜ å°„
        const languageNames = {
            'zh-CN': 'ç®€ä½“ä¸­æ–‡',
            'zh-TW': 'ç¹ä½“ä¸­æ–‡',
            'en': 'English',
            'ja': 'æ—¥è¯­ ğŸ‡¯ğŸ‡µ',
            'ko': 'éŸ©è¯­ ğŸ‡°ğŸ‡·',
            'fr': 'æ³•è¯­ ğŸ‡«ğŸ‡·',
            'de': 'å¾·è¯­ ğŸ‡©ğŸ‡ª',
            'es': 'è¥¿ç­ç‰™è¯­ ğŸ‡ªğŸ‡¸',
            'ru': 'ä¿„è¯­ ğŸ‡·ğŸ‡º',
            'ar': 'é˜¿æ‹‰ä¼¯è¯­ ğŸ‡¸ğŸ‡¦',
            'pt': 'è‘¡è„ç‰™è¯­ ğŸ‡µğŸ‡¹',
            'it': 'æ„å¤§åˆ©è¯­ ğŸ‡®ğŸ‡¹',
            'nl': 'è·å…°è¯­ ğŸ‡³ğŸ‡±',
            'sv': 'ç‘å…¸è¯­ ğŸ‡¸ğŸ‡ª',
            'da': 'ä¸¹éº¦è¯­ ğŸ‡©ğŸ‡°',
            'no': 'æŒªå¨è¯­ ğŸ‡³ğŸ‡´',
            'fi': 'èŠ¬å…°è¯­ ğŸ‡«ğŸ‡®',
            'pl': 'æ³¢å…°è¯­ ğŸ‡µğŸ‡±',
            'cs': 'æ·å…‹è¯­ ğŸ‡¨ğŸ‡¿',
            'hu': 'åŒˆç‰™åˆ©è¯­ ğŸ‡­ğŸ‡º',
            'tr': 'åœŸè€³å…¶è¯­ ğŸ‡¹ğŸ‡·',
            'th': 'æ³°è¯­ ğŸ‡¹ğŸ‡­',
            'vi': 'è¶Šå—è¯­ ğŸ‡»ğŸ‡³',
            'hi': 'å°åœ°è¯­ ğŸ‡®ğŸ‡³',
            'he': 'å¸Œä¼¯æ¥è¯­ ğŸ‡®ğŸ‡±',
            'uk': 'ä¹Œå…‹å…°è¯­ ğŸ‡ºğŸ‡¦'
        };

        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, type = 'info') {
            elements.status.className = `status ${type}`;
            elements.status.textContent = message;
            elements.status.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    elements.status.style.display = 'none';
                }, 3000);
            }
        }

        // æ›´æ–°é…ç½®çŠ¶æ€æ˜¾ç¤º
        function updateConfigStatus() {
            const isConfigured = config.apiUrl && config.apiKey;
            if (isConfigured) {
                elements.configStatus.className = 'config-status configured';
                elements.statusIndicator.className = 'status-indicator configured';
                elements.statusText.textContent = t('statusConfigured');
                elements.modelInfo.classList.remove('hidden');
                elements.currentModel.textContent = config.modelName;
            } else {
                elements.configStatus.className = 'config-status not-configured';
                elements.statusIndicator.className = 'status-indicator';
                elements.statusText.textContent = t('statusConfigNeeded');
                elements.modelInfo.classList.add('hidden');
            }
        }

        // æ›´æ–°é€‰ä¸­è®¡æ•°æ˜¾ç¤º
        function updateSelectionDisplay() {
            elements.selectionCount.textContent = selectedCount;
            
            const hasConfig = config.apiUrl && config.apiKey && config.modelName;
            elements.translateBtn.disabled = !hasConfig || selectedCount === 0 || isTranslating;
        }

        // æ›´æ–°UIçŠ¶æ€
        function updateUI() {
            updateConfigStatus();
            updateSelectionDisplay();
        }

        // æ˜¾ç¤ºè®¾ç½®å¼¹çª—
        function showSettingsModal() {
            elements.settingsModal.classList.add('show');
            // å¼¹çª—æ˜¾ç¤ºåè°ƒæ•´é«˜åº¦
            setTimeout(() => {
                adjustUIHeight();
            }, 300); // ç­‰å¾…åŠ¨ç”»å®Œæˆ
        }

        // éšè—è®¾ç½®å¼¹çª—
        function hideSettingsModal() {
            elements.settingsModal.classList.remove('show');
            // å¼¹çª—éšè—åè°ƒæ•´é«˜åº¦
            setTimeout(() => {
                adjustUIHeight();
            }, 300); // ç­‰å¾…åŠ¨ç”»å®Œæˆ
        }

        // åŠ è½½é…ç½®
        function loadConfig() {
            parent.postMessage({ 
                pluginMessage: { type: 'load-config' } 
            }, '*');
        }

        // ä¿å­˜é…ç½®
        function saveConfig() {
            config.apiUrl = elements.apiUrl.value.trim();
            config.apiKey = elements.apiKey.value.trim();
            config.modelName = elements.modelName.value.trim();
            config.customPrompt = elements.customPrompt.value.trim();
            
            parent.postMessage({ 
                pluginMessage: { 
                    type: 'save-config',
                    config: config
                } 
            }, '*');
        }

        // ä¿å­˜è¯­è¨€è®¾ç½®
        function saveLanguage() {
            const newLanguage = elements.targetLanguage.value;
            config.targetLanguage = newLanguage;
            
            parent.postMessage({
                pluginMessage: {
                    type: 'save-language',
                    language: newLanguage
                }
            }, '*');
        }

        // å¼€å§‹ç¿»è¯‘
        function startTranslation() {
            if (selectedCount === 0) return;
            
            if (isTranslating) {
                // åœæ­¢ç¿»è¯‘
                parent.postMessage({ 
                    pluginMessage: { type: 'stop-translation' } 
                }, '*');
                return;
            }
            
            isTranslating = true;
            elements.translateBtn.className = 'btn btn-stop';
            elements.translateBtn.innerHTML = '<span class="loading"><span class="stop-spinner"></span>åœæ­¢ç¿»è¯‘</span>';
            elements.progress.classList.remove('hidden');
            elements.progressInfo.classList.remove('hidden');
            elements.progressBar.style.width = '0%';
            
            parent.postMessage({ 
                pluginMessage: { type: 'translate' } 
            }, '*');
        }

        // é‡ç½®ç¿»è¯‘æŒ‰é’®
        function resetTranslateButton() {
            isTranslating = false;
            elements.translateBtn.disabled = false;
            elements.translateBtn.innerHTML = `
                <span class="material-symbols-outlined icon-small">rocket_launch</span>
                <span data-i18n="startTranslation">${t('startTranslation')}</span>
            `;
            elements.progress.classList.add('hidden');
            elements.progressInfo.classList.add('hidden');
        }

        // Promptæ¨¡æ¿ç‚¹å‡»äº‹ä»¶
        function setupPromptTemplates() {
            const promptTags = document.querySelectorAll('.prompt-tag');
            promptTags.forEach(tag => {
                tag.addEventListener('click', () => {
                    const prompt = tag.getAttribute('data-prompt');
                    elements.customPrompt.value = prompt;
                });
            });
        }

        // ä¿å­˜è‡ªå®šä¹‰æç¤ºè¯
        function saveCustomPrompt() {
            const promptName = elements.promptName.value.trim();
            const prompt = elements.customPrompt.value.trim();

            if (!promptName || !prompt) {
                showStatus(t('promptSavedFailed'), 'warning');
                return;
            }

            // å‘é€æ¶ˆæ¯åˆ°åç«¯ä¿å­˜
            parent.postMessage({
                pluginMessage: {
                    type: 'save-custom-prompt',
                    name: promptName,
                    content: prompt
                }
            }, '*');

            elements.promptName.value = ''; // æ¸…ç©ºåç§°è¾“å…¥æ¡†
        }

        // æ¸²æŸ“è‡ªå®šä¹‰æç¤ºè¯æ¨¡æ¿
        function renderCustomPrompts(customPrompts) {
            const promptTemplates = document.querySelector('.prompt-templates');
            // ç§»é™¤æ‰€æœ‰è‡ªå®šä¹‰æ¨¡æ¿
            const customTags = promptTemplates.querySelectorAll('.custom-prompt-tag');
            customTags.forEach(tag => tag.remove());

            // æ·»åŠ è‡ªå®šä¹‰æ¨¡æ¿
            if (customPrompts && customPrompts.length > 0) {
                customPrompts.forEach(prompt => {
                    const customTag = document.createElement('span');
                    customTag.className = 'prompt-tag custom-prompt-tag';
                    customTag.setAttribute('data-prompt', prompt.content);
                    customTag.innerHTML = `
                        ${prompt.name}
                        <span class="delete-prompt" data-id="${prompt.id}">
                            <span class="material-symbols-outlined icon-small">close</span>
                        </span>
                    `;
                    
                    // ç‚¹å‡»æ¨¡æ¿ä½¿ç”¨æç¤ºè¯
                    customTag.addEventListener('click', (e) => {
                        if (!e.target.closest('.delete-prompt')) {
                            elements.customPrompt.value = prompt.content;
                        }
                    });
                    
                    // ç‚¹å‡»åˆ é™¤æŒ‰é’®
                    const deleteBtn = customTag.querySelector('.delete-prompt');
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        deleteCustomPrompt(prompt.id);
                    });
                    
                    promptTemplates.appendChild(customTag);
                });
            }
        }

        // åˆ é™¤è‡ªå®šä¹‰æç¤ºè¯
        function deleteCustomPrompt(promptId) {
            parent.postMessage({
                pluginMessage: {
                    type: 'delete-custom-prompt',
                    id: promptId
                }
            }, '*');
        }

        // ä¿å­˜è‡ªå®šä¹‰æ¨¡å‹
        function saveCustomModel() {
            const modelName = elements.modelName.value.trim();

            if (!modelName) {
                showStatus(t('modelSavedFailed'), 'warning');
                return;
            }

            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒçš„æ¨¡å‹
            const existingModels = config.customModels || [];
            const isDuplicate = existingModels.some(model => model.modelName === modelName);
            
            if (isDuplicate) {
                showStatus(t('modelSavedDuplicate'), 'warning');
                return;
            }

            // å‘é€æ¶ˆæ¯åˆ°åç«¯ä¿å­˜
            parent.postMessage({
                pluginMessage: {
                    type: 'save-custom-model',
                    name: modelName, // ç›´æ¥ä½¿ç”¨æ¨¡å‹åç§°ä½œä¸ºæ˜¾ç¤ºåç§°
                    modelName: modelName
                }
            }, '*');
        }

        // æ¸²æŸ“è‡ªå®šä¹‰æ¨¡å‹æ¨¡æ¿
        function renderCustomModels(customModels) {
            const modelTemplates = document.querySelector('.model-templates');
            // ç§»é™¤æ‰€æœ‰è‡ªå®šä¹‰æ¨¡å‹
            const customTags = modelTemplates.querySelectorAll('.custom-model-tag');
            customTags.forEach(tag => tag.remove());

            // æ·»åŠ è‡ªå®šä¹‰æ¨¡å‹
            if (customModels && customModels.length > 0) {
                customModels.forEach(model => {
                    const customTag = document.createElement('span');
                    customTag.className = 'model-tag custom-model-tag';
                    customTag.setAttribute('data-model', model.modelName);
                    customTag.innerHTML = `
                        ${model.name}
                        <span class="delete-model" data-id="${model.id}">
                            <span class="material-symbols-outlined icon-small">close</span>
                        </span>
                    `;
                    
                    // ç‚¹å‡»æ¨¡å‹ä½¿ç”¨æ¨¡å‹åç§°
                    customTag.addEventListener('click', (e) => {
                        if (!e.target.closest('.delete-model')) {
                            elements.modelName.value = model.modelName;
                        }
                    });
                    
                    // ç‚¹å‡»åˆ é™¤æŒ‰é’®
                    const deleteBtn = customTag.querySelector('.delete-model');
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        deleteCustomModel(model.id);
                    });
                    
                    modelTemplates.appendChild(customTag);
                });
            }
        }

        // åˆ é™¤è‡ªå®šä¹‰æ¨¡å‹
        function deleteCustomModel(modelId) {
            parent.postMessage({
                pluginMessage: {
                    type: 'delete-custom-model',
                    id: modelId
                }
            }, '*');
        }

        // æ¸²æŸ“å¿«é€Ÿåˆ‡æ¢æ¨¡å‹ä¸‹æ‹‰æ¡†
        function renderQuickModelSelect() {
            const quickModelSelect = elements.quickModelSelect;
            
            // æ¸…ç©ºæ‰€æœ‰é€‰é¡¹
            quickModelSelect.innerHTML = '';
            
            // æ·»åŠ é»˜è®¤æ¨¡å‹é€‰é¡¹
            const defaultOption = document.createElement('option');
            defaultOption.value = 'gpt-4.1-nano';
            defaultOption.textContent = 'gpt-4.1-nano';
            quickModelSelect.appendChild(defaultOption);
            
            // æ·»åŠ è‡ªå®šä¹‰æ¨¡å‹é€‰é¡¹
            if (config.customModels && config.customModels.length > 0) {
                config.customModels.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model.modelName;
                    option.textContent = model.name;
                    quickModelSelect.appendChild(option);
                });
            }
            
            // è®¾ç½®å½“å‰é€‰ä¸­çš„æ¨¡å‹
            quickModelSelect.value = config.modelName || 'gpt-4.1-nano';
        }

        // æ¸²æŸ“å¿«é€Ÿåˆ‡æ¢æç¤ºè¯ä¸‹æ‹‰æ¡†
        function renderQuickPromptSelect() {
            const quickPromptSelect = elements.quickPromptSelect;
            
            // æ¸…ç©ºæ‰€æœ‰é€‰é¡¹
            quickPromptSelect.innerHTML = '';
            
            // é¢„è®¾æç¤ºè¯æ˜ å°„
            const defaultPrompts = {
                'standard': {
                    name: t('templateStandard'),
                    content: t('promptContentStandard')
                },
                'localization': {
                    name: t('templateLocalization'),
                    content: t('promptContentLocalization')
                },
                'ui': {
                    name: t('templateUI'),
                    content: t('promptContentUI')
                },
                'technical': {
                    name: t('templateTechnical'),
                    content: t('promptContentTechnical')
                }
            };
            
            // æ·»åŠ é»˜è®¤æç¤ºè¯é€‰é¡¹
            Object.keys(defaultPrompts).forEach(key => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = defaultPrompts[key].name;
                option.setAttribute('data-prompt', defaultPrompts[key].content);
                quickPromptSelect.appendChild(option);
            });
            
            // æ·»åŠ è‡ªå®šä¹‰æç¤ºè¯é€‰é¡¹
            if (config.customPrompts && config.customPrompts.length > 0) {
                config.customPrompts.forEach(prompt => {
                    const option = document.createElement('option');
                    option.value = `custom_${prompt.id}`;
                    option.textContent = `${prompt.name} (è‡ªå®šä¹‰)`;
                    option.setAttribute('data-prompt', prompt.content);
                    quickPromptSelect.appendChild(option);
                });
            }
            
            // è®¾ç½®å½“å‰é€‰ä¸­çš„æç¤ºè¯
            const currentPrompt = config.customPrompt;
            let selectedValue = 'standard'; // é»˜è®¤é€‰æ‹©æ ‡å‡†ç¿»è¯‘
            
            // æ£€æŸ¥æ˜¯å¦åŒ¹é…é¢„è®¾æç¤ºè¯
            for (const [key, prompt] of Object.entries(defaultPrompts)) {
                if (prompt.content === currentPrompt) {
                    selectedValue = key;
                    break;
                }
            }
            
            // æ£€æŸ¥æ˜¯å¦åŒ¹é…è‡ªå®šä¹‰æç¤ºè¯
            if (config.customPrompts) {
                const matchedCustom = config.customPrompts.find(p => p.content === currentPrompt);
                if (matchedCustom) {
                    selectedValue = `custom_${matchedCustom.id}`;
                }
            }
            
            quickPromptSelect.value = selectedValue;
        }

        // åˆ‡æ¢æ¨¡å‹
        function switchModel(modelName) {
            config.modelName = modelName;
            elements.modelName.value = modelName;
            
            // æ›´æ–°æ˜¾ç¤º
            elements.currentModel.textContent = modelName;
            
            // é€šçŸ¥ä¸»çº¿ç¨‹æ›´æ–°é…ç½®
            parent.postMessage({
                pluginMessage: {
                    type: 'update-config',
                    config: config
                }
            }, '*');
            
            updateUI();
            showStatus(t('modelSwitched', { modelName: modelName }), 'success');
        }

        // åˆ‡æ¢æç¤ºè¯
        function switchPrompt(promptValue, isCustom = false) {
            if (isCustom) {
                config.customPrompt = promptValue;
                elements.customPrompt.value = promptValue;
            } else {
                // è·å–é»˜è®¤æç¤ºè¯æ˜ å°„
                const defaultPrompts = {
                    'standard': {
                        name: t('templateStandard'),
                        content: t('promptContentStandard')
                    },
                    'localization': {
                        name: t('templateLocalization'),
                        content: t('promptContentLocalization')
                    },
                    'ui': {
                        name: t('templateUI'),
                        content: t('promptContentUI')
                    },
                    'technical': {
                        name: t('templateTechnical'),
                        content: t('promptContentTechnical')
                    }
                };
                
                if (defaultPrompts[promptValue]) {
                    config.customPrompt = defaultPrompts[promptValue].content;
                    elements.customPrompt.value = config.customPrompt;
                }
            }
            
            // é€šçŸ¥ä¸»çº¿ç¨‹æ›´æ–°é…ç½®
            parent.postMessage({
                pluginMessage: {
                    type: 'update-config',
                    config: config
                }
            }, '*');
            
            showStatus(t('promptSwitched'), 'success');
        }

        // åˆå§‹åŒ–å¿«é€Ÿåˆ‡æ¢ä¸‹æ‹‰æ¡†çš„äº‹ä»¶ç›‘å¬
        function initQuickSwitchEvents() {
            // æ¨¡å‹ä¸‹æ‹‰æ¡†å˜åŒ–äº‹ä»¶
            elements.quickModelSelect.addEventListener('change', (e) => {
                switchModel(e.target.value);
            });
            
            // æç¤ºè¯ä¸‹æ‹‰æ¡†å˜åŒ–äº‹ä»¶
            elements.quickPromptSelect.addEventListener('change', (e) => {
                switchPrompt(e.target.value);
            });
        }

        // äº‹ä»¶ç›‘å¬
        elements.saveConfig.addEventListener('click', saveConfig);
        elements.translateBtn.addEventListener('click', startTranslation);
        elements.settingsToggle.addEventListener('click', showSettingsModal);
        elements.closeModal.addEventListener('click', hideSettingsModal);
        elements.targetLanguage.addEventListener('change', saveLanguage);
        elements.savePromptBtn.addEventListener('click', saveCustomPrompt);
        elements.quickSaveModelBtn.addEventListener('click', saveCustomModel); // æ·»åŠ å¿«é€Ÿä¿å­˜æŒ‰é’®äº‹ä»¶

        // ä¸ºæ¨¡å‹è¾“å…¥æ¡†æ·»åŠ å›è½¦é”®å¿«é€Ÿä¿å­˜
        elements.modelName.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                saveCustomModel();
            }
        });

        // ç‚¹å‡»é®ç½©å…³é—­å¼¹çª—
        elements.settingsModal.addEventListener('click', (e) => {
            if (e.target === elements.settingsModal) {
                hideSettingsModal();
            }
        });

        // ESCé”®å…³é—­å¼¹çª—
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && elements.settingsModal.classList.contains('show')) {
                hideSettingsModal();
            }
        });

        // æ¶ˆæ¯å¤„ç†
        window.onmessage = (event) => {
            const msg = event.data.pluginMessage;
            
            switch (msg.type) {
                case 'config-loaded':
                    config = { ...config, ...msg.config };
                    updateUI();
                    break;
                    
                case 'config-saved':
                    showStatus(t('configSaved'), 'success');
                    updateUI();
                    // æ›´æ–°å¿«é€Ÿåˆ‡æ¢åŒºåŸŸ
                    renderQuickModelSelect();
                    renderQuickPromptSelect();
                    break;

                case 'language-saved':
                    showStatus(t('languageSwitched', { language: t('languages.' + msg.language) }), 'success');
                    break;
                    
                case 'selection-changed':
                    selectedCount = msg.count;
                    elements.selectionCount.textContent = selectedCount;
                    elements.translateBtn.disabled = selectedCount === 0 || !config.apiUrl || !config.apiKey;
                    break;
                    
                case 'translation-started':
                    isTranslating = true;
                    elements.translateBtn.disabled = false;
                    elements.translateBtn.innerHTML = `
                        <span class="material-symbols-outlined icon-small">stop</span>
                        <span data-i18n="stopTranslation">${t('stopTranslation')}</span>
                    `;
                    elements.progress.classList.remove('hidden');
                    elements.progressInfo.classList.remove('hidden');
                    showStatus(t('translationStarted'), 'info');
                    break;

                case 'translation-stopped':
                    showStatus(t('translationStopping'), 'warning');
                    elements.translateBtn.innerHTML = `<span class="loading"><span class="stop-spinner"></span>${t('statusStopping')}</span>`;
                    break;

                case 'translation-stopped-complete':
                    resetTranslateButton();
                    showStatus(t('translationStopped', { completed: msg.completed, total: msg.total }), 'warning');
                    break;
                    
                case 'translation-progress':
                    elements.progressBar.style.width = `${msg.progress}%`;
                    let progressText;
                    
                    if (msg.status === 'processing') {
                        progressText = t('progressProcessingDetail', { 
                            completed: msg.completed, 
                            total: msg.total, 
                            currentText: msg.currentText 
                        });
                    } else if (msg.currentText) {
                        progressText = t('progressTranslatingDetail', { 
                            completed: msg.completed, 
                            total: msg.total, 
                            progress: msg.progress, 
                            currentText: msg.currentText 
                        });
                    } else {
                        progressText = t('progressTranslatingSimple', { 
                            completed: msg.completed, 
                            total: msg.total, 
                            progress: msg.progress 
                        });
                    }
                    
                    elements.progressInfo.textContent = progressText;
                    break;
                    
                case 'translation-completed':
                    resetTranslateButton();
                    const message = msg.hasError 
                        ? t('translationCompletedPartial', { completed: msg.completed, total: msg.total })
                        : t('translationCompletedAll');
                    showStatus(message, msg.hasError ? 'warning' : 'success');
                    break;
                    
                case 'error':
                    resetTranslateButton();
                    showStatus(msg.message, 'error');
                    break;

                case 'custom-prompt-saved':
                    showStatus(t('promptSaved', { name: msg.name }), 'success');
                    renderCustomPrompts(msg.prompts);
                    // æ›´æ–°æœ¬åœ°configä¸­çš„è‡ªå®šä¹‰æç¤ºè¯æ•°æ®
                    config.customPrompts = msg.prompts;
                    // æ›´æ–°å¿«é€Ÿåˆ‡æ¢æç¤ºè¯ä¸‹æ‹‰æ¡†
                    renderQuickPromptSelect();
                    break;

                case 'custom-prompt-deleted':
                    showStatus(t('promptDeleted', { name: msg.name }), 'success');
                    renderCustomPrompts(msg.prompts);
                    // æ›´æ–°æœ¬åœ°configä¸­çš„è‡ªå®šä¹‰æç¤ºè¯æ•°æ®
                    config.customPrompts = msg.prompts;
                    // æ›´æ–°å¿«é€Ÿåˆ‡æ¢æç¤ºè¯ä¸‹æ‹‰æ¡†
                    renderQuickPromptSelect();
                    break;

                case 'custom-model-saved':
                    showStatus(t('modelSaved', { name: msg.name }), 'success');
                    renderCustomModels(msg.models);
                    // æ›´æ–°æœ¬åœ°configä¸­çš„è‡ªå®šä¹‰æ¨¡å‹æ•°æ®
                    config.customModels = msg.models;
                    // æ›´æ–°å¿«é€Ÿåˆ‡æ¢æ¨¡å‹ä¸‹æ‹‰æ¡†
                    renderQuickModelSelect();
                    break;

                case 'custom-model-deleted':
                    showStatus(t('modelDeleted', { name: msg.name }), 'success');
                    renderCustomModels(msg.models);
                    // æ›´æ–°æœ¬åœ°configä¸­çš„è‡ªå®šä¹‰æ¨¡å‹æ•°æ®
                    config.customModels = msg.models;
                    // æ›´æ–°å¿«é€Ÿåˆ‡æ¢æ¨¡å‹ä¸‹æ‹‰æ¡†
                    renderQuickModelSelect();
                    break;
            }
        };

        // åˆå§‹åŒ–
        updateUI();
        setupPromptTemplates();
        initQuickSwitchEvents();
        initLanguage(); // åˆå§‹åŒ–è¯­è¨€è®¾ç½®
        loadConfig(); // åŠ è½½é…ç½®
    </script>
</body>
</html> 